<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
<title>Dice Roller — The Tome</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark:#1a1a2e; --bg-panel:#16213e; --text-light:#e8e8e8;
  --text-muted:#9a9ab0; --text-dim:#6a6a80;
  --gold:#c9a84c; --gold-dim:#8a6a2c; --border:#2a2a4a;
  --acc:#7b5ea7; --acc-dim:#4a2d7a;
  --green-hi:#6dcc88; --green-mid:#9dd08a;
  --red-hi:#e07060; --red-deep:#c0392b;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{font-family:'EB Garamond',Georgia,serif;background:var(--bg-dark);color:var(--text-light);min-height:100vh;overflow-x:hidden;
  background-image:radial-gradient(ellipse at 15% 20%,rgba(74,0,120,0.2) 0%,transparent 52%),radial-gradient(ellipse at 85% 75%,rgba(0,55,110,0.18) 0%,transparent 52%);}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;opacity:0.025;
  background-image:repeating-linear-gradient(0deg,transparent,transparent 59px,rgba(201,168,76,1) 59px,rgba(201,168,76,1) 60px),
  repeating-linear-gradient(90deg,transparent,transparent 59px,rgba(201,168,76,1) 59px,rgba(201,168,76,1) 60px);}

/* NAV */
.nav-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.55);z-index:998;opacity:0;pointer-events:none;transition:opacity 0.25s ease;}
.nav-overlay.open{opacity:1;pointer-events:all;}
.nav-drawer{position:fixed;top:0;right:-310px;width:290px;height:100vh;background:rgba(13,20,45,0.99);border-left:1px solid var(--border);backdrop-filter:blur(16px);z-index:999;transition:right 0.28s cubic-bezier(0.4,0,0.2,1);display:flex;flex-direction:column;}
.nav-drawer.open{right:0;}
.nav-drawer-header{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid var(--border);flex-shrink:0;}
.nav-drawer-title{font-family:'Cinzel',serif;font-size:0.75rem;font-weight:700;letter-spacing:0.18em;text-transform:uppercase;color:var(--gold);}
.nav-close-btn{background:none;border:none;color:var(--text-muted);font-size:1.3rem;cursor:pointer;padding:4px 6px;line-height:1;border-radius:4px;transition:color 0.15s;}
.nav-close-btn:hover{color:var(--text-light);}
.nav-scroll{flex:1;overflow-y:auto;padding:8px 0 24px;}
.nav-section-label{font-family:'Cinzel',serif;font-size:0.58rem;font-weight:700;letter-spacing:0.22em;text-transform:uppercase;color:var(--text-dim);padding:16px 20px 6px;display:block;}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 20px;text-decoration:none;color:var(--text-muted);font-family:'Cinzel',serif;font-size:0.75rem;font-weight:600;letter-spacing:0.07em;text-transform:uppercase;border-left:3px solid transparent;transition:all 0.14s;}
.nav-item:hover,.nav-item.active{color:var(--gold);background:rgba(201,168,76,0.07);border-left-color:var(--gold-dim);}
.nav-item .ni{width:1.1rem;height:1.1rem;flex-shrink:0;opacity:0.75;}
.nav-item:hover .ni,.nav-item.active .ni{opacity:1;}
.hamburger-btn{background:none;border:1px solid var(--border);border-radius:6px;padding:7px 10px;cursor:pointer;display:flex;flex-direction:column;gap:5px;transition:border-color 0.15s;flex-shrink:0;}
.hamburger-btn:hover{border-color:var(--gold-dim);}
.hamburger-btn span{display:block;width:20px;height:2px;background:var(--text-muted);border-radius:2px;transition:background 0.15s;}
.hamburger-btn:hover span{background:var(--gold);}

/* HEADER */
#site-header{position:sticky;top:0;z-index:100;background:rgba(22,33,62,0.97);border-bottom:1px solid var(--border);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:space-between;padding:12px 20px;}
.site-logo{display:flex;align-items:center;gap:9px;font-family:'Cinzel',serif;font-size:1rem;font-weight:900;letter-spacing:0.1em;text-transform:uppercase;color:var(--gold);text-shadow:0 0 18px rgba(201,168,76,0.35);text-decoration:none;}
.site-logo svg{width:1.2rem;height:1.2rem;flex-shrink:0;}
.page-title{font-family:'Cinzel',serif;font-size:0.72rem;font-weight:700;letter-spacing:0.18em;text-transform:uppercase;color:var(--acc);opacity:0.9;}

/* LAYOUT */
.page-wrap{position:relative;z-index:1;min-height:calc(100vh - 52px);display:flex;flex-direction:column;}
.content-wrap{max-width:760px;margin:0 auto;width:100%;padding:32px 20px 60px;}
.page-heading{font-family:'Cinzel',serif;font-size:clamp(1.5rem,4vw,2.4rem);font-weight:900;letter-spacing:0.08em;text-transform:uppercase;color:var(--gold);line-height:1.05;margin-bottom:6px;text-shadow:0 0 30px rgba(201,168,76,0.25),0 2px 6px rgba(0,0,0,0.7);}
.page-sub{font-size:1rem;color:var(--text-muted);font-style:italic;letter-spacing:0.03em;margin-bottom:28px;}

/* PANEL */
.panel{background:rgba(22,33,62,0.65);border:1px solid var(--border);border-radius:10px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.4);backdrop-filter:blur(8px);margin-bottom:18px;}
.panel.hidden{display:none;}
.panel-head{padding:14px 18px 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(22,33,62,0.5);}
.panel-title{font-family:'Cinzel',serif;font-size:0.68rem;font-weight:700;letter-spacing:0.2em;text-transform:uppercase;color:var(--text-dim);}
.panel-body{padding:18px;}

/* DICE */
.dice-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.dice-btn{font-family:'Cinzel',serif;font-size:1rem;font-weight:700;letter-spacing:0.06em;padding:16px 10px;border-radius:8px;border:1px solid rgba(123,94,167,0.35);background:rgba(123,94,167,0.12);color:var(--text-light);cursor:pointer;transition:background 0.14s,border-color 0.14s,transform 0.06s,box-shadow 0.14s;user-select:none;}
.dice-btn:hover{background:rgba(123,94,167,0.28);border-color:rgba(123,94,167,0.65);box-shadow:0 0 14px rgba(123,94,167,0.2);}
.dice-btn:active{transform:translateY(1px);}

/* FORM */
.field-label{font-family:'Cinzel',serif;font-size:0.6rem;font-weight:700;letter-spacing:0.18em;text-transform:uppercase;color:var(--text-dim);display:block;margin-bottom:8px;}
.field-input{width:100%;padding:12px 14px;border-radius:7px;border:1px solid var(--border);background:rgba(0,0,0,0.3);color:var(--text-light);font-family:'EB Garamond',Georgia,serif;font-size:1rem;transition:border-color 0.15s;}
.field-input:focus{outline:none;border-color:var(--acc);}
.field-hint{font-size:0.82rem;color:var(--text-dim);font-style:italic;margin-top:6px;}
.field-error{font-size:0.82rem;color:var(--red-hi);font-style:italic;margin-top:6px;display:none;}
.field-error.show{display:block;}
.roll-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end;margin-top:14px;}
.roll-btn{font-family:'Cinzel',serif;font-size:0.75rem;font-weight:700;letter-spacing:0.12em;text-transform:uppercase;padding:12px 22px;border-radius:7px;border:1px solid var(--gold-dim);background:linear-gradient(135deg,rgba(138,106,44,0.5),rgba(201,168,76,0.2));color:var(--gold);cursor:pointer;transition:all 0.14s;white-space:nowrap;}
.roll-btn:hover{background:linear-gradient(135deg,rgba(138,106,44,0.8),rgba(201,168,76,0.35));box-shadow:0 0 16px rgba(201,168,76,0.2);}
.roll-btn:active{transform:translateY(1px);}

/* RESULT */
.result-wrap{margin-top:20px;padding-top:18px;border-top:1px solid var(--border);}
.result-total{font-family:'Cinzel',serif;font-size:clamp(2.8rem,8vw,4.5rem);font-weight:900;color:var(--gold);line-height:1;text-shadow:0 0 30px rgba(201,168,76,0.45);}
.result-total.roll-flash{animation:flash-in 0.28s ease;}
@keyframes flash-in{0%{transform:scale(1.12);opacity:0.6;}100%{transform:scale(1);opacity:1;}}
.result-detail{margin-top:8px;font-size:0.9rem;color:var(--text-muted);font-style:italic;}

/* CRIT */
.crit-banner{display:none;align-items:center;justify-content:center;gap:10px;margin-top:14px;padding:10px 16px;border-radius:8px;font-family:'Cinzel',serif;font-size:0.8rem;font-weight:700;letter-spacing:0.14em;text-transform:uppercase;animation:flash-in 0.3s ease;}
.crit-banner.show{display:flex;}
.crit-banner.nat20{background:rgba(201,168,76,0.15);border:1px solid rgba(201,168,76,0.45);color:var(--gold);}
.crit-banner.nat1{background:rgba(192,57,43,0.12);border:1px solid rgba(192,57,43,0.4);color:var(--red-hi);}
.crit-banner svg{width:1.3rem;height:1.3rem;flex-shrink:0;}

/* SYSTEM SWITCHER */
.sys-toggle{display:flex;border:1px solid var(--border);border-radius:8px;overflow:hidden;margin-bottom:20px;}
.sys-opt{font-family:'Cinzel',serif;font-size:0.65rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;padding:10px 6px;flex:1;border:none;background:transparent;color:var(--text-muted);cursor:pointer;transition:background 0.14s,color 0.14s;border-right:1px solid var(--border);}
.sys-opt:last-child{border-right:none;}
.sys-opt.active{background:rgba(123,94,167,0.22);color:var(--text-light);}
.sys-opt:not(.active):hover{background:rgba(255,255,255,0.04);color:var(--text-light);}
.sys-section{display:none;}
.sys-section.show{display:block;}

/* COC SKILL */
.skill-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end;margin-top:16px;}
.skill-thresholds{display:none;margin-top:14px;border:1px solid var(--border);border-radius:8px;overflow:hidden;}
.skill-thresholds.show{display:block;}
.thresh-row{display:grid;grid-template-columns:1fr auto;align-items:center;padding:8px 13px;border-bottom:1px solid rgba(255,255,255,0.05);border-left:3px solid transparent;font-family:'EB Garamond',Georgia,serif;font-size:0.88rem;transition:background 0.15s,border-left-color 0.15s;}
.thresh-row:last-child{border-bottom:none;}
.thresh-label{color:var(--text-muted);}
.thresh-val{font-family:'Cinzel',serif;font-size:0.75rem;font-weight:700;letter-spacing:0.06em;color:var(--text-dim);}
.thresh-row.t-extreme .thresh-label,.thresh-row.t-extreme .thresh-val{color:var(--gold);}
.thresh-row.t-hard    .thresh-label,.thresh-row.t-hard    .thresh-val{color:var(--green-mid);}
.thresh-row.t-standard .thresh-label,.thresh-row.t-standard .thresh-val{color:var(--green-hi);}
.thresh-row.t-fail    .thresh-label,.thresh-row.t-fail    .thresh-val{color:var(--red-hi);}
.thresh-row.t-fumble  .thresh-label,.thresh-row.t-fumble  .thresh-val{color:var(--red-deep);}
.thresh-row.active-thresh{background:rgba(255,255,255,0.05);}
.thresh-row.t-extreme.active-thresh{border-left-color:var(--gold);}
.thresh-row.t-hard.active-thresh{border-left-color:var(--green-mid);}
.thresh-row.t-standard.active-thresh{border-left-color:var(--green-hi);}
.thresh-row.t-fail.active-thresh{border-left-color:var(--red-hi);}
.thresh-row.t-fumble.active-thresh{border-left-color:var(--red-deep);}
.skill-result{margin-top:10px;padding:12px 14px;border-radius:7px;border:1px solid var(--border);background:rgba(0,0,0,0.2);font-family:'Cinzel',serif;font-size:0.82rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;display:none;}
.skill-result.show{display:block;}
.skill-result.pass   {border-color:rgba(80,180,100,0.5);color:var(--green-hi);background:rgba(80,180,100,0.08);}
.skill-result.fail   {border-color:rgba(192,57,43,0.4);color:var(--red-hi);background:rgba(192,57,43,0.08);}
.skill-result.extreme{border-color:rgba(201,168,76,0.5);color:var(--gold);background:rgba(201,168,76,0.1);}
.skill-result.fumble {border-color:rgba(140,30,30,0.6);color:var(--red-deep);background:rgba(140,30,30,0.1);}

/* ADVANTAGE */
.adv-toggle{display:grid;grid-template-columns:1fr 1fr;border:1px solid var(--border);border-radius:8px;overflow:hidden;}
.adv-opt{font-family:'Cinzel',serif;font-size:0.72rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;padding:12px 10px;border:none;background:transparent;color:var(--text-muted);cursor:pointer;transition:background 0.14s,color 0.14s;}
.adv-opt:first-child{border-right:1px solid var(--border);}
.adv-opt.active{background:rgba(123,94,167,0.22);color:var(--text-light);}
.adv-opt:not(.active):hover{background:rgba(255,255,255,0.04);color:var(--text-light);}
.adv-mod-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end;margin-top:14px;}
.mod-input{width:100%;padding:12px 14px;border-radius:7px;border:1px solid var(--border);background:rgba(0,0,0,0.3);color:var(--text-light);font-family:'EB Garamond',Georgia,serif;font-size:1rem;transition:border-color 0.15s;}
.mod-input:focus{outline:none;border-color:var(--acc);}

/* SAVED */
.saved-grid{display:flex;flex-wrap:wrap;gap:8px;min-height:36px;}
.saved-btn-wrap{position:relative;display:inline-flex;}
.saved-btn{font-family:'Cinzel',serif;font-size:0.78rem;font-weight:700;letter-spacing:0.06em;padding:10px 32px 10px 14px;border-radius:7px;border:1px solid rgba(201,168,76,0.3);background:rgba(201,168,76,0.08);color:var(--gold);cursor:pointer;transition:background 0.14s,border-color 0.14s,transform 0.06s;user-select:none;white-space:nowrap;}
.saved-btn:hover{background:rgba(201,168,76,0.2);border-color:rgba(201,168,76,0.55);}
.saved-btn:active{transform:translateY(1px);}
.saved-remove{position:absolute;top:50%;right:5px;transform:translateY(-50%);background:none;border:none;color:var(--text-dim);font-size:0.75rem;cursor:pointer;padding:2px 4px;line-height:1;border-radius:3px;transition:color 0.12s;}
.saved-remove:hover{color:var(--red-hi);}
.saved-empty{font-size:0.9rem;color:var(--text-dim);font-style:italic;}

/* HISTORY */
.hist-clear-btn{font-family:'Cinzel',serif;font-size:0.62rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;padding:7px 14px;border-radius:6px;border:1px solid rgba(192,57,43,0.4);background:rgba(192,57,43,0.1);color:var(--red-hi);cursor:pointer;transition:all 0.14s;}
.hist-clear-btn:hover{background:rgba(192,57,43,0.25);border-color:rgba(192,57,43,0.65);}
.history-item{font-size:0.9rem;padding:10px 13px;border:1px solid rgba(255,255,255,0.07);border-radius:7px;margin-bottom:8px;background:rgba(255,255,255,0.03);color:var(--text-muted);line-height:1.4;font-family:'EB Garamond',Georgia,serif;}
.history-item:last-child{margin-bottom:0;}
.hist-total{color:var(--gold);font-weight:600;}
.hist-empty{font-size:0.9rem;color:var(--text-dim);font-style:italic;}

/* FOOTER */
.site-footer{margin-top:auto;position:relative;z-index:1;padding:24px 20px;border-top:1px solid var(--border);text-align:center;font-size:0.78rem;color:var(--text-dim);font-style:italic;background:rgba(16,24,50,0.45);}

@media(max-width:640px){
  #site-header{padding:10px 16px;}
  .content-wrap{padding:22px 14px 48px;}
  .sys-opt{font-size:0.58rem;padding:10px 4px;}
}
</style>
</head>
<body>

<div class="nav-overlay" id="nav-overlay" onclick="closeNav()"></div>
<nav class="nav-drawer" id="nav-drawer" aria-label="Site navigation">
  <div class="nav-drawer-header">
    <span class="nav-drawer-title">The Tome</span>
    <button class="nav-close-btn" onclick="closeNav()" aria-label="Close">&#x2715;</button>
  </div>
  <div class="nav-scroll">
    <span class="nav-section-label">Home</span>
    <a href="index.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      &nbsp;Hub
    </a>
    <span class="nav-section-label">Reference</span>
    <a href="spelltome.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      &nbsp;Spell Tome
    </a>
    <a href="conditions.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      &nbsp;Condition Codex
    </a>
    <a href="wildshape.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>
      &nbsp;Wildshape &amp; Familiar
    </a>
    <a href="monsters.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="M12.5 17h-1a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1z"/><path d="M12 2C6.5 2 2 6.5 2 12c0 3.04 1.36 5.75 3.5 7.59V20h13v-.41C20.64 17.75 22 15.04 22 12 22 6.5 17.5 2 12 2z"/></svg>
      &nbsp;Monster Codex
    </a>
    <a href="magic-items.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="6 3 18 3 22 9 12 22 2 9"/><line x1="2" y1="9" x2="22" y2="9"/><line x1="12" y1="3" x2="6" y2="9"/><line x1="12" y1="3" x2="18" y2="9"/></svg>
      &nbsp;Magic Item Compendium
    </a>
    <span class="nav-section-label">Table Tools</span>
    <a href="combat-tracker.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="21" y2="19"/><polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5"/><line x1="5" y1="14" x2="9" y2="18"/><line x1="7" y1="17" x2="3" y2="21"/><line x1="3" y1="19" x2="5" y2="21"/></svg>
      &nbsp;Combat Tracker
    </a>
    <a href="dice-roller.html" class="nav-item active">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="3" width="8" height="8" rx="1.5"/><rect x="13" y="3" width="8" height="8" rx="1.5"/><rect x="3" y="13" width="8" height="8" rx="1.5"/><rect x="13" y="13" width="8" height="8" rx="1.5"/><circle cx="7" cy="7" r="1" fill="currentColor" stroke="none"/><circle cx="17" cy="7" r="1" fill="currentColor" stroke="none"/><circle cx="7" cy="17" r="1" fill="currentColor" stroke="none"/><circle cx="17" cy="17" r="1" fill="currentColor" stroke="none"/></svg>
      &nbsp;Dice Roller
    </a>
      <span class="nav-section-label">Campaigns</span>
      <a href="campaign-tracker.html" class="nav-item">
        <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        &nbsp;Campaign Chronicle
      </a>
  </div>
</nav>

<header id="site-header">
  <a href="index.html" class="site-logo">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
    The Tome
  </a>
  <span class="page-title" id="page-title">Dice Roller</span>
  <button class="hamburger-btn" onclick="openNav()" aria-label="Open navigation">
    <span></span><span></span><span></span>
  </button>
</header>

<div class="page-wrap">
  <div class="content-wrap">

    <div class="page-heading">Dice Roller</div>
    <div class="page-sub" id="page-sub">Quick rolls and custom expressions for any system</div>

    <!-- QUICK ROLL -->
    <div class="panel">
      <div class="panel-head">
        <span class="panel-title" id="panel-roll-title">Quick Roll</span>
      </div>
      <div class="panel-body">

        <div class="sys-toggle" role="group" aria-label="Game system">
          <button class="sys-opt active" id="sys-dnd" type="button" onclick="setSystem('dnd')">D&amp;D 5e</button>
          <button class="sys-opt" id="sys-coc" type="button" onclick="setSystem('coc')">Call of Cthulhu</button>
          <button class="sys-opt" id="sys-gen" type="button" onclick="setSystem('generic')">Generic</button>
        </div>

        <!-- D&D 5e dice -->
        <div class="sys-section show" id="sec-dnd">
          <div class="dice-grid">
            <button class="dice-btn" type="button" onclick="quickRoll(4)">d4</button>
            <button class="dice-btn" type="button" onclick="quickRoll(6)">d6</button>
            <button class="dice-btn" type="button" onclick="quickRoll(8)">d8</button>
            <button class="dice-btn" type="button" onclick="quickRoll(10)">d10</button>
            <button class="dice-btn" type="button" onclick="quickRoll(12)">d12</button>
            <button class="dice-btn" type="button" onclick="quickRoll(20)">d20</button>
          </div>
        </div>

        <!-- CoC dice + skill check -->
        <div class="sys-section" id="sec-coc">
          <div class="dice-grid" style="margin-bottom:16px;">
            <button class="dice-btn" type="button" onclick="quickRoll(3)">d3</button>
            <button class="dice-btn" type="button" onclick="quickRoll(6)">d6</button>
            <button class="dice-btn" type="button" onclick="quickRoll(8)">d8</button>
            <button class="dice-btn" type="button" onclick="quickRoll(10)">d10</button>
            <button class="dice-btn" type="button" onclick="rollPercentile()">d100</button>
            <button class="dice-btn" type="button" onclick="quickRoll(20)">d20</button>
          </div>
          <label class="field-label" for="skill-target">Skill check</label>
          <div class="skill-row">
            <input class="field-input" id="skill-target" type="number" min="1" max="99" placeholder="Skill % (e.g. 55)" />
            <button class="roll-btn" type="button" onclick="rollSkillCheck()">Check</button>
          </div>
          <div class="field-error" id="skill-error"></div>
          <div class="skill-thresholds" id="skill-thresholds">
            <div class="thresh-row t-extreme" id="thr-extreme"><span class="thresh-label">Extreme Success</span><span class="thresh-val" id="thr-extreme-val"></span></div>
            <div class="thresh-row t-hard"     id="thr-hard">   <span class="thresh-label">Hard Success</span>   <span class="thresh-val" id="thr-hard-val"></span></div>
            <div class="thresh-row t-standard" id="thr-standard"><span class="thresh-label">Regular Success</span><span class="thresh-val" id="thr-standard-val"></span></div>
            <div class="thresh-row t-fail"     id="thr-fail">   <span class="thresh-label">Failure</span>        <span class="thresh-val" id="thr-fail-val"></span></div>
            <div class="thresh-row t-fumble"   id="thr-fumble"> <span class="thresh-label">Fumble</span>         <span class="thresh-val" id="thr-fumble-val"></span></div>
          </div>
          <div class="skill-result" id="skill-result"></div>
        </div>

        <!-- Generic dice -->
        <div class="sys-section" id="sec-gen">
          <div class="dice-grid">
            <button class="dice-btn" type="button" onclick="quickRoll(4)">d4</button>
            <button class="dice-btn" type="button" onclick="quickRoll(6)">d6</button>
            <button class="dice-btn" type="button" onclick="quickRoll(8)">d8</button>
            <button class="dice-btn" type="button" onclick="quickRoll(10)">d10</button>
            <button class="dice-btn" type="button" onclick="quickRoll(12)">d12</button>
            <button class="dice-btn" type="button" onclick="quickRoll(20)">d20</button>
            <button class="dice-btn" type="button" onclick="quickRoll(100)">d100</button>
            <button class="dice-btn" type="button" onclick="quickRoll(2)">d2</button>
            <button class="dice-btn" type="button" onclick="quickRoll(3)">d3</button>
          </div>
        </div>

        <!-- Custom expression (always shown) -->
        <div style="margin-top:20px;">
          <label class="field-label" for="expression">Custom expression</label>
          <input class="field-input" id="expression" placeholder="e.g. 2d6+3, 1d20+5" autocomplete="off" spellcheck="false" />
          <div class="roll-row">
            <div>
              <div class="field-hint">Format: NdS+M &mdash; e.g. d20, 2d6+3, 4d8-2</div>
              <div class="field-error" id="expr-error"></div>
            </div>
            <button class="roll-btn" type="button" onclick="rollExpression()">Roll</button>
          </div>
        </div>

        <div class="result-wrap" id="result-wrap" style="display:none;">
          <div class="result-total" id="result"></div>
          <div class="result-detail" id="result-detail"></div>
          <div class="crit-banner nat20" id="crit-nat20"></div>
          <div class="crit-banner nat1"  id="crit-nat1"></div>
        </div>

      </div>
    </div>

    <!-- SAVED EXPRESSIONS -->
    <div class="panel" id="saved-panel">
      <div class="panel-head">
        <span class="panel-title">Saved Expressions</span>
        <button class="hist-clear-btn" type="button" onclick="clearSaved()">Clear All</button>
      </div>
      <div class="panel-body">
        <div class="saved-grid" id="saved-grid"></div>
      </div>
    </div>

    <!-- ADVANTAGE / DISADVANTAGE — hidden when CoC active -->
    <div class="panel" id="adv-panel">
      <div class="panel-head">
        <span class="panel-title">Advantage / Disadvantage</span>
      </div>
      <div class="panel-body">
        <div class="adv-toggle" role="group" aria-label="Roll mode">
          <button class="adv-opt active" id="adv-btn" type="button" onclick="setAdvMode('advantage')">Advantage</button>
          <button class="adv-opt" id="dis-btn" type="button" onclick="setAdvMode('disadvantage')">Disadvantage</button>
        </div>
        <div class="adv-mod-row">
          <div>
            <label class="field-label" for="adv-modifier">Modifier (optional)</label>
            <input class="mod-input" id="adv-modifier" type="number" placeholder="+0" />
          </div>
          <button class="roll-btn" type="button" onclick="rollAdvantage()">Roll 2d20</button>
        </div>
        <div class="result-wrap" id="adv-result-wrap" style="display:none;">
          <div class="result-total" id="adv-result"></div>
          <div class="result-detail" id="adv-result-detail"></div>
          <div class="crit-banner nat20" id="adv-crit-nat20"></div>
          <div class="crit-banner nat1"  id="adv-crit-nat1"></div>
        </div>
      </div>
    </div>

    <!-- HISTORY -->
    <div class="panel">
      <div class="panel-head">
        <span class="panel-title">Roll History</span>
        <button class="hist-clear-btn" type="button" onclick="clearHistory()">Clear</button>
      </div>
      <div class="panel-body">
        <div id="history"></div>
      </div>
    </div>

  </div>
  <footer class="site-footer" id="site-footer">
    <p id="footer-dnd">All content derived from the D&amp;D 5e Systems Reference Document (SRD 5.1). For use by players and Dungeon Masters at the table.</p>
    <p id="footer-coc" style="display:none;">Call of Cthulhu is a registered trademark of Chaosium Inc. Skill check thresholds per 7th Edition rules.</p>
    <p id="footer-gen" style="display:none;">Generic dice roller. Compatible with any tabletop system.</p>
  </footer>
</div>

<script>
const SKULL_SVG  = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" width="22" height="22"><circle cx="12" cy="9" r="6"/><path d="M9 9h.01"/><path d="M15 9h.01"/><path d="M9.5 12.5c.8.6 4.2.6 5 0"/><path d="M10 15v3"/><path d="M14 15v3"/><path d="M8 21h8"/></svg>`;
const SWORDS_SVG = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" width="22" height="22"><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="M13 19l6-6"/><path d="M16 16l4 4"/><path d="M19 21l2-2"/><path d="M9.5 6.5L11 5l-2-2-7 7 2 2 1.5-1.5"/><path d="M15 5l-1 1"/><path d="M5 15l-1 1"/></svg>`;

// ---- SYSTEM ----
let currentSystem = 'dnd';

function setSystem(sys){
  currentSystem = sys;
  // Toggle buttons
  document.getElementById('sys-dnd').classList.toggle('active', sys==='dnd');
  document.getElementById('sys-coc').classList.toggle('active', sys==='coc');
  document.getElementById('sys-gen').classList.toggle('active', sys==='generic');
  // Toggle sections
  document.getElementById('sec-dnd').classList.toggle('show', sys==='dnd');
  document.getElementById('sec-coc').classList.toggle('show', sys==='coc');
  document.getElementById('sec-gen').classList.toggle('show', sys==='generic');
  // Advantage panel: not relevant for CoC
  document.getElementById('adv-panel').classList.toggle('hidden', sys==='coc');
  // Footer
  document.getElementById('footer-dnd').style.display = sys==='dnd'     ? '' : 'none';
  document.getElementById('footer-coc').style.display = sys==='coc'     ? '' : 'none';
  document.getElementById('footer-gen').style.display = sys==='generic' ? '' : 'none';
  // Clear main results and crits on switch
  showCrit(null,'main');
  // Reset CoC state when leaving
  if(sys!=='coc'){
    document.getElementById('skill-thresholds').classList.remove('show');
    document.getElementById('skill-result').className='skill-result';
    document.getElementById('skill-error').classList.remove('show');
  }
}

// ---- CRIT ----
function showCrit(type, panel){
  const p  = panel==='adv' ? 'adv-' : '';
  const b20 = document.getElementById(p+'crit-nat20');
  const b1  = document.getElementById(p+'crit-nat1');
  if(!b20||!b1) return;
  b20.classList.remove('show'); b1.classList.remove('show');
  if(type===20){ b20.innerHTML=SWORDS_SVG+' Natural 20'; b20.classList.add('show'); }
  if(type===1) { b1.innerHTML =SKULL_SVG +' Natural 1';  b1.classList.add('show');  }
}
function checkD20Crit(rolls,sides,panel){
  if(currentSystem==='coc'){ showCrit(null,panel); return; }
  showCrit((sides===20&&rolls.length===1)?rolls[0]:null, panel);
}

// ---- ADVANTAGE ----
let advMode='advantage';
function setAdvMode(mode){
  advMode=mode;
  document.getElementById('adv-btn').classList.toggle('active',mode==='advantage');
  document.getElementById('dis-btn').classList.toggle('active',mode==='disadvantage');
}
function rollAdvantage(){
  const r1=randomInt(1,20), r2=randomInt(1,20);
  const isAdv=advMode==='advantage';
  const chosen=isAdv?Math.max(r1,r2):Math.min(r1,r2);
  const mod=parseInt(document.getElementById('adv-modifier').value,10)||0;
  const total=chosen+mod;
  const label=isAdv?'Advantage':'Disadvantage';
  const modTxt=mod?(' '+(mod>0?'+':'')+mod):'';
  const wrap=document.getElementById('adv-result-wrap');
  const res=document.getElementById('adv-result');
  const det=document.getElementById('adv-result-detail');
  wrap.style.display='block';
  res.textContent=total; res.classList.remove('roll-flash'); void res.offsetWidth; res.classList.add('roll-flash');
  det.textContent=label+modTxt+' \u2192 ['+r1+', '+r2+']';
  showCrit(chosen,'adv');
  pushHistory(stamp()+'&nbsp; &bull; &nbsp;'+label+' (2d20)'+modTxt+'&nbsp; &rarr; &nbsp;<span class="hist-total">'+total+'</span>&nbsp;&nbsp;<span style="color:var(--text-dim);font-size:0.8rem;">['+r1+', '+r2+']</span>');
}

// ---- COC ----
function rollPercentile(){
  const tens=randomInt(0,9)*10, units=randomInt(0,9);
  const total=(tens+units===0)?100:tens+units;
  displayResult({total,expr:'d100',rolls:[tens,units],modifier:0,forceSides:100});
}

const THRESH_IDS=['thr-extreme','thr-hard','thr-standard','thr-fail','thr-fumble'];

function renderThresholds(target){
  const half=Math.floor(target/2), fifth=Math.floor(target/5);
  const tbl=document.getElementById('skill-thresholds');
  if(!target||target<1||target>99){ tbl.classList.remove('show'); return; }
  document.getElementById('thr-extreme-val').textContent ='01 \u2013 '+fifth;
  document.getElementById('thr-hard-val').textContent    =(fifth+1)+' \u2013 '+half;
  document.getElementById('thr-standard-val').textContent=(half+1)+' \u2013 '+target;
  document.getElementById('thr-fail-val').textContent    =(target+1)+' \u2013 95';
  document.getElementById('thr-fumble-val').textContent  ='96 \u2013 100';
  tbl.classList.add('show');
  THRESH_IDS.forEach(id=>document.getElementById(id).classList.remove('active-thresh'));
}

function rollSkillCheck(){
  const errEl=document.getElementById('skill-error');
  const target=parseInt(document.getElementById('skill-target').value.trim(),10);
  if(isNaN(target)||target<1||target>99){
    errEl.textContent='Enter a skill % between 1 and 99.'; errEl.classList.add('show'); return;
  }
  errEl.classList.remove('show');
  renderThresholds(target);
  const half=Math.floor(target/2), fifth=Math.floor(target/5);
  const roll=randomInt(1,100);
  const el=document.getElementById('skill-result');
  el.className='skill-result';
  let outcome,cls,activeRow;
  if(roll===1)         {outcome='Critical Success \u2014 01';   cls='extreme';activeRow='thr-extreme';}
  else if(roll>=96)    {outcome='Fumble \u2014 '+roll;          cls='fumble'; activeRow='thr-fumble'; }
  else if(roll<=fifth) {outcome='Extreme Success \u2014 '+roll; cls='extreme';activeRow='thr-extreme';}
  else if(roll<=half)  {outcome='Hard Success \u2014 '+roll;    cls='pass';   activeRow='thr-hard';  }
  else if(roll<=target){outcome='Regular Success \u2014 '+roll; cls='pass';   activeRow='thr-standard';}
  else                 {outcome='Failure \u2014 '+roll;         cls='fail';   activeRow='thr-fail';  }
  document.getElementById(activeRow).classList.add('active-thresh');
  el.classList.add(cls,'show');
  el.textContent=outcome;
  pushHistory(stamp()+'&nbsp; &bull; &nbsp;CoC Skill Check ('+target+'%)&nbsp; &rarr; &nbsp;<span class="hist-total">'+roll+'</span>&nbsp;&nbsp;<span style="color:var(--text-dim);font-size:0.8rem;">'+outcome+'</span>');
}

// ---- SAVED ----
const SAVED_KEY='diceSaved_v1';
function loadSaved(){ try{return JSON.parse(localStorage.getItem(SAVED_KEY))||[];}catch(e){return[];} }
function saveSaved(arr){ localStorage.setItem(SAVED_KEY,JSON.stringify(arr)); }
function renderSaved(){
  const grid=document.getElementById('saved-grid');
  const arr=loadSaved();
  if(!arr.length){ grid.innerHTML='<span class="saved-empty">Rolled expressions will appear here.</span>'; return; }
  grid.innerHTML='';
  arr.forEach(expr=>{
    const wrap=document.createElement('div'); wrap.className='saved-btn-wrap';
    const btn=document.createElement('button'); btn.className='saved-btn'; btn.type='button'; btn.textContent=expr; btn.title='Roll '+expr;
    btn.addEventListener('click',()=>{ document.getElementById('expression').value=expr; rollExpression(); });
    const rm=document.createElement('button'); rm.className='saved-remove'; rm.type='button'; rm.innerHTML='&#x2715;'; rm.title='Remove '+expr;
    rm.addEventListener('click',e=>{ e.stopPropagation(); removeExpression(expr); });
    wrap.appendChild(btn); wrap.appendChild(rm); grid.appendChild(wrap);
  });
}
function addExpression(expr){
  const arr=loadSaved(),n=expr.replace(/\s+/g,'').toLowerCase();
  if(arr.includes(n)) return;
  arr.push(n); saveSaved(arr); renderSaved();
}
function removeExpression(expr){ saveSaved(loadSaved().filter(e=>e!==expr)); renderSaved(); }
function clearSaved(){ localStorage.removeItem(SAVED_KEY); renderSaved(); }

// ---- CORE ----
function openNav(){ document.getElementById('nav-drawer').classList.add('open'); document.getElementById('nav-overlay').classList.add('open'); document.body.style.overflow='hidden'; }
function closeNav(){ document.getElementById('nav-drawer').classList.remove('open'); document.getElementById('nav-overlay').classList.remove('open'); document.body.style.overflow=''; }
document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeNav(); });

function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function stamp(){ const d=new Date(); return d.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})+', '+d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'}); }

function pushHistory(html){
  const histDiv=document.getElementById('history');
  const empty=histDiv.querySelector('.hist-empty'); if(empty) empty.remove();
  const item=document.createElement('div'); item.className='history-item'; item.innerHTML=html;
  histDiv.prepend(item);
  localStorage.setItem('diceHistory_v2',histDiv.innerHTML);
}

function quickRoll(sides){
  const roll=randomInt(1,sides);
  displayResult({total:roll,expr:'1d'+sides,rolls:[roll],modifier:0,forceSides:sides});
}

function rollExpression(){
  const errEl=document.getElementById('expr-error');
  const exprRaw=document.getElementById('expression').value.trim().toLowerCase();
  const expr=exprRaw.replace(/\s+/g,'');
  const match=expr.match(/^(\d*)d(\d+)([+-]\d+)?$/);
  if(!match){ errEl.textContent='Invalid expression. Example: 2d6+3'; errEl.classList.add('show'); return; }
  const count=match[1]?parseInt(match[1],10):1;
  const sides=parseInt(match[2],10);
  const modifier=match[3]?parseInt(match[3],10):0;
  if(count<1||count>200){ errEl.textContent='Dice count must be 1-200.'; errEl.classList.add('show'); return; }
  if(sides<2||sides>1000000){ errEl.textContent='Sides must be 2-1,000,000.'; errEl.classList.add('show'); return; }
  errEl.classList.remove('show');
  const rolls=[]; for(let i=0;i<count;i++) rolls.push(randomInt(1,sides));
  const total=rolls.reduce((a,b)=>a+b,0)+modifier;
  const finalExpr=exprRaw||expr;
  displayResult({total,expr:finalExpr,rolls,modifier,forceSides:sides});
  addExpression(finalExpr);
}

function displayResult({total,expr,rolls,modifier,forceSides}){
  const wrap=document.getElementById('result-wrap');
  const res=document.getElementById('result');
  const det=document.getElementById('result-detail');
  wrap.style.display='block';
  res.textContent=total; res.classList.remove('roll-flash'); void res.offsetWidth; res.classList.add('roll-flash');
  const modTxt=modifier?(' '+(modifier>0?'+':'')+modifier):'';
  det.textContent=rolls.length>1?expr+modTxt+' \u2192 ['+rolls.join(', ')+']':expr;
  checkD20Crit(rolls,forceSides||null,'main');
  pushHistory(stamp()+'&nbsp; &bull; &nbsp;'+expr+modTxt+'&nbsp; &rarr; &nbsp;<span class="hist-total">'+total+'</span>&nbsp;&nbsp;<span style="color:var(--text-dim);font-size:0.8rem;">['+rolls.join(', ')+']</span>');
}

function clearHistory(){
  document.getElementById('history').innerHTML='<div class="hist-empty">No rolls yet.</div>';
  localStorage.removeItem('diceHistory_v2');
}

// ---- INIT ----
window.addEventListener('load',()=>{
  renderSaved();
  const saved=localStorage.getItem('diceHistory_v2');
  document.getElementById('history').innerHTML=saved||'<div class="hist-empty">No rolls yet.</div>';

  document.getElementById('expression').addEventListener('keydown',e=>{ if(e.key==='Enter') rollExpression(); });
  document.getElementById('expression').addEventListener('input',()=>document.getElementById('expr-error').classList.remove('show'));
  document.getElementById('adv-modifier').addEventListener('keydown',e=>{ if(e.key==='Enter') rollAdvantage(); });

  const skillEl=document.getElementById('skill-target');
  skillEl.addEventListener('keydown',e=>{ if(e.key==='Enter') rollSkillCheck(); });
  skillEl.addEventListener('input',e=>{
    const v=parseInt(e.target.value,10);
    document.getElementById('skill-error').classList.remove('show');
    document.getElementById('skill-result').className='skill-result';
    THRESH_IDS.forEach(id=>document.getElementById(id).classList.remove('active-thresh'));
    if(v>=1&&v<=99) renderThresholds(v);
    else document.getElementById('skill-thresholds').classList.remove('show');
  });
});
</script>
</body>
</html>
