<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
<title>Wildshape & Familiar — D&D 5e Reference</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark:#1a1a2e; --bg-panel:#16213e; --text-light:#e8e8e8;
  --text-muted:#9a9ab0; --text-dim:#6a6a80; --gold:#c9a84c;
  --gold-dim:#8a6a2c; --border:#2a2a4a;
  --druid-green:#2a6a3a; --druid-green-light:#3a9a5a;
  --find-purple:#6a2a8a; --find-purple-light:#8a4aaa;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { overflow-x: hidden; }
body {
  font-family: 'EB Garamond', Georgia, serif;
  background: var(--bg-dark); color: var(--text-light); min-height: 100vh;
  background-image:
    radial-gradient(ellipse at 20% 50%, rgba(0,80,40,0.15) 0%, transparent 60%),
    radial-gradient(ellipse at 80% 20%, rgba(60,0,100,0.12) 0%, transparent 60%);
}
#app-header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(22,33,62,0.97); border-bottom: 1px solid var(--border);
  backdrop-filter: blur(12px);
}
.header-top {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 24px 10px; border-bottom: 1px solid rgba(255,255,255,0.05);
}
.app-title {
  font-family: 'Cinzel', serif; font-size: 1.3rem; font-weight: 900;
  letter-spacing: 0.06em; color: var(--gold);
  text-shadow: 0 0 20px rgba(201,168,76,0.4); text-transform: uppercase;
}
.app-title span { color: var(--text-muted); font-weight: 400; font-size: 0.85rem; margin-left: 8px; letter-spacing: 0.15em; }
.nav-links { display: flex; gap: 8px; align-items: center; }
.nav-link {
  font-family: 'Cinzel', serif; font-size: 0.7rem; font-weight: 600;
  letter-spacing: 0.08em; text-transform: uppercase; text-decoration: none;
  border: 1px solid var(--border); border-radius: 4px; padding: 5px 12px;
  color: var(--text-muted); transition: all 0.15s;
}
.nav-link:hover { color: var(--gold); border-color: rgba(201,168,76,0.4); }

/* MODE TOGGLE */
.mode-toggle {
  display: flex; align-items: center;
  background: rgba(255,255,255,0.05); border: 1px solid var(--border);
  border-radius: 6px; padding: 3px; gap: 2px;
}
.mode-btn {
  font-family: 'Cinzel', serif; font-size: 0.72rem; font-weight: 600;
  letter-spacing: 0.08em; text-transform: uppercase;
  border: none; border-radius: 4px; padding: 6px 16px;
  cursor: pointer; transition: all 0.15s ease;
  background: transparent; color: var(--text-muted);
}
.mode-btn:hover { color: var(--text-light); }
.mode-btn.active.druid { background: linear-gradient(135deg, #3a9a5a, #2a6a3a); color: #fff; box-shadow: 0 1px 6px rgba(58,154,90,0.35); }
.mode-btn.active.familiar { background: linear-gradient(135deg, #8a4aaa, #6a2a8a); color: #fff; box-shadow: 0 1px 6px rgba(138,74,170,0.35); }

.filter-bar {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 24px 12px; flex-wrap: wrap;
}
.filter-label {
  font-family: 'Cinzel', serif; font-size: 0.68rem;
  letter-spacing: 0.1em; text-transform: uppercase;
  color: var(--text-dim); white-space: nowrap;
}
select, input[type="text"] {
  font-family: 'EB Garamond', serif; font-size: 0.95rem;
  background: #0d1a30; color: #e8e8e8; border: 1px solid #3a3a5a;
  border-radius: 4px; padding: 5px 10px; outline: none;
  transition: border-color 0.15s, background 0.15s;
}
select {
  padding-right: 28px; appearance: none; -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23c9a84c'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 8px center;
  background-color: #0d1a30; cursor: pointer;
}
select option { background: #0d1a30; color: #e8e8e8; }
select:focus, input[type="text"]:focus {
  border-color: var(--gold-dim); background: #111f38;
  box-shadow: 0 0 0 2px rgba(201,168,76,0.15);
}
input[type="text"]::placeholder { color: #6a6a80; }
.search-input { min-width: 180px; }
.pill-filters { display: flex; gap: 4px; flex-wrap: wrap; }
.pill {
  font-family: 'Cinzel', serif; font-size: 0.62rem; letter-spacing: 0.06em;
  font-weight: 600; border-radius: 3px; padding: 3px 8px;
  cursor: pointer; border: 1px solid var(--border);
  background: rgba(255,255,255,0.04); color: var(--text-muted);
  transition: all 0.15s; user-select: none;
}
.pill:hover { border-color: var(--text-dim); color: var(--text-light); }
.pill.active { background: rgba(201,168,76,0.18); border-color: var(--gold-dim); color: var(--gold); }
.btn-reset {
  font-family: 'Cinzel', serif; font-size: 0.7rem; font-weight: 600;
  letter-spacing: 0.05em; text-transform: uppercase;
  border: 1px solid var(--border); border-radius: 4px; padding: 5px 10px;
  cursor: pointer; background: transparent; color: var(--text-muted);
  transition: all 0.15s; white-space: nowrap;
}
.btn-reset:hover { color: var(--gold); border-color: rgba(201,168,76,0.5); }
.filter-divider { width: 1px; height: 24px; background: var(--border); flex-shrink: 0; }

/* DRUID INFO PANEL */
.druid-info-bar {
  background: rgba(42,106,58,0.15); border-bottom: 1px solid rgba(58,154,90,0.2);
  padding: 8px 24px; display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
}
.druid-rule {
  font-size: 0.82rem; color: var(--text-muted);
  display: flex; align-items: center; gap: 6px;
}
.druid-rule strong { color: var(--druid-green-light); font-family: 'Cinzel', serif; font-size: 0.72rem; letter-spacing: 0.05em; }
.familiar-info-bar {
  background: rgba(106,42,138,0.12); border-bottom: 1px solid rgba(138,74,170,0.2);
  padding: 8px 24px; display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
}
.familiar-rule {
  font-size: 0.82rem; color: var(--text-muted);
  display: flex; align-items: center; gap: 6px;
}
.familiar-rule strong { color: #8a4aaa; font-family: 'Cinzel', serif; font-size: 0.72rem; letter-spacing: 0.05em; }

#results-bar {
  padding: 7px 24px; font-size: 0.85rem; color: var(--text-dim);
  border-bottom: 1px solid var(--border); font-style: italic;
  background: rgba(15,52,96,0.2);
}
#card-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 18px; padding: 24px;
}
#empty-state {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 80px 24px; text-align: center; color: var(--text-dim);
}
#empty-state .rune { width: 4rem; height: 4rem; opacity: 0.25; margin-bottom: 20px; display: block; }
#empty-state h2 { font-family: 'Cinzel', serif; font-size: 1.3rem; color: var(--text-muted); margin-bottom: 10px; letter-spacing: 0.05em; }

/* BEAST CARD */
.beast-card {
  background: #fff; border-radius: 7px; overflow: hidden; cursor: pointer;
  box-shadow: 0 3px 16px rgba(0,0,0,0.45);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  color: #222; font-family: 'EB Garamond', Georgia, serif;
  font-size: 0.83rem; line-height: 1.4; border: 2.5px solid transparent;
}
.beast-card:hover { transform: translateY(-4px); box-shadow: 0 10px 36px rgba(0,0,0,0.6); }
.beast-card.wildshape { border-color: rgba(42,106,58,0.3); }
.beast-card.familiar { border-color: rgba(106,42,138,0.3); }

.card-header {
  padding: 9px 11px 7px; display: flex; align-items: flex-start; gap: 8px;
}
.card-name-block { flex: 1; min-width: 0; }
.card-name {
  font-family: 'Cinzel', serif; font-weight: 700;
  font-size: clamp(0.68rem, 2vw, 0.88rem); letter-spacing: 0.03em;
  text-transform: uppercase; color: #fff; line-height: 1.2;
  text-shadow: 0 1px 3px rgba(0,0,0,0.35); overflow-wrap: break-word;
}
.card-subline { font-size: 0.7rem; color: rgba(255,255,255,0.75); font-style: italic; margin-top: 1px; }
.cr-badge {
  font-family: 'Cinzel', serif; font-weight: 700; font-size: 0.7rem;
  background: rgba(0,0,0,0.25); color: rgba(255,255,255,0.95);
  border-radius: 3px; padding: 2px 6px; flex-shrink: 0; white-space: nowrap; margin-top: 2px;
}
.card-core-stats {
  display: grid; grid-template-columns: repeat(4, 1fr);
  padding: 5px 11px 4px; background: #fff; gap: 2px;
}
.core-stat { text-align: center; }
.core-stat .cs-label { font-size: 0.6rem; color: #888; font-family: 'Cinzel', serif; letter-spacing: 0.08em; text-transform: uppercase; display: block; }
.core-stat .cs-val { font-family: 'Cinzel', serif; font-weight: 700; font-size: 0.8rem; color: #222; }
.card-tags {
  padding: 4px 11px 5px; background: #f7f5f0; border-top: 1px solid #eee;
  display: flex; flex-wrap: wrap; gap: 3px;
}
.tag {
  font-family: 'Cinzel', serif; font-size: 0.5rem; font-weight: 700;
  letter-spacing: 0.05em; text-transform: uppercase; border-radius: 3px;
  padding: 2px 5px;
}
.tag.swim { background: #ddeeff; color: #336; }
.tag.fly { background: #eeeeff; color: #446; }
.tag.climb { background: #eefee8; color: #363; }
.tag.burrow { background: #f5f0e0; color: #553; }
.tag.darkvision { background: #2a2a3a; color: #aaa; }
.tag.blindsight { background: #1a1a2a; color: #888; }
.tag.pack-tactics { background: #fff0e0; color: #a63; }
.tag.special { background: #f0e8ff; color: #553; }
.tag.eligible { background: #e8ffe8; color: #363; }
.tag.level-req { background: rgba(201,168,76,0.15); color: #7a5500; border: 1px solid rgba(201,168,76,0.3); }
.card-note {
  padding: 4px 11px 7px; background: #fff; font-size: 0.75rem;
  color: #444; font-style: italic; border-top: 1px solid #f0f0f0; line-height: 1.35;
}

/* DRUID ELIGIBILITY CHECKER */
.druid-level-banner {
  padding: 6px 24px; background: rgba(42,106,58,0.08);
  border-bottom: 1px solid rgba(42,106,58,0.15);
  display: flex; align-items: center; gap: 10px;
}
.druid-level-banner label {
  font-family: 'Cinzel', serif; font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-dim);
}

/* MODAL */
#modal-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,0.88); z-index: 1000;
  align-items: center; justify-content: center;
  padding: 24px; backdrop-filter: blur(4px);
}
#modal-overlay.active { display: flex; }
#modal-box {
  background: #fff; border-radius: 10px; overflow: hidden;
  max-width: 560px; width: 100%; max-height: 85vh;
  overflow-y: auto; box-shadow: 0 8px 48px rgba(0,0,0,0.7);
  color: #222; font-family: 'EB Garamond', serif;
}
.modal-header {
  display: flex; align-items: flex-start; justify-content: space-between;
  gap: 10px; padding: 14px 16px; position: sticky; top: 0;
}
.modal-title { font-family: 'Cinzel', serif; font-weight: 700; font-size: 1.1rem; letter-spacing: 0.05em; text-transform: uppercase; color: #fff; text-shadow: 0 1px 4px rgba(0,0,0,0.35); }
.modal-subtitle { font-size: 0.82rem; color: rgba(255,255,255,0.75); font-style: italic; margin-top: 2px; }
.modal-close {
  font-family: 'Cinzel', serif; font-size: 0.7rem; font-weight: 600;
  background: rgba(0,0,0,0.25); border: none; color: rgba(255,255,255,0.9);
  border-radius: 4px; padding: 5px 12px; cursor: pointer; flex-shrink: 0;
}
.modal-close:hover { background: rgba(0,0,0,0.4); }
.modal-body { padding: 16px; }
.stat-row-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 14px; }
.stat-box { background: #f7f5f0; border-radius: 5px; padding: 7px 8px; text-align: center; }
.stat-box .lb { font-family: 'Cinzel', serif; font-size: 0.58rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: #888; }
.stat-box .vl { font-family: 'Cinzel', serif; font-weight: 700; font-size: 0.95rem; color: #222; }
.ab-grid { display: grid; grid-template-columns: repeat(6,1fr); gap: 5px; margin-bottom: 14px; }
.ab-box { background: #f7f5f0; border-radius: 5px; padding: 6px 4px; text-align: center; }
.ab-box .abl { font-family: 'Cinzel', serif; font-size: 0.55rem; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 0.1em; }
.ab-box .abs { font-family: 'Cinzel', serif; font-weight: 700; font-size: 0.88rem; color: #222; }
.ab-box .abm { font-size: 0.7rem; color: #555; }
.msec { margin-top: 12px; }
.msec-label { font-family: 'Cinzel', serif; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; margin-bottom: 6px; padding-bottom: 3px; border-bottom: 1px solid #eee; }
.mabil { margin-bottom: 5px; font-size: 0.88rem; color: #333; line-height: 1.45; }
.mabil strong { font-weight: 700; }
.eligibility-panel { background: #f0faf4; border-radius: 6px; padding: 10px 12px; margin-bottom: 12px; border: 1px solid #c0e0c8; }
.eligibility-title { font-family: 'Cinzel', serif; font-size: 0.72rem; font-weight: 700; letter-spacing: 0.1em; color: #2a6a3a; margin-bottom: 6px; text-transform: uppercase; }
.eligibility-row { font-size: 0.85rem; color: #333; margin-bottom: 3px; }
.eligibility-row .ok { color: #2a6a3a; font-weight: 600; }
.eligibility-row .no { color: #8a2a2a; font-weight: 600; }

.btn { font-family: 'Cinzel', serif; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; border: none; border-radius: 4px; padding: 7px 16px; cursor: pointer; transition: all 0.15s ease; }
.btn-print { background: linear-gradient(135deg, #c9a84c, #8a6a2c); color: #1a1a2e; font-weight: 700; box-shadow: 0 2px 12px rgba(201,168,76,0.3); }
.btn-print:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(201,168,76,0.5); }
.btn-print:disabled { opacity: 0.38; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
.btn-ghost { font-family: 'Cinzel', serif; font-size: 0.7rem; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; border: 1px solid var(--border); border-radius: 4px; padding: 5px 12px; cursor: pointer; background: transparent; color: var(--text-muted); transition: all 0.15s; white-space: nowrap; }
.btn-ghost:hover { color: var(--gold); border-color: rgba(201,168,76,0.4); }
.btn-ghost:disabled { opacity: 0.3; cursor: not-allowed; }
.selection-badge { font-family: 'Cinzel', serif; font-size: 0.78rem; color: var(--gold); background: rgba(201,168,76,0.12); border: 1px solid rgba(201,168,76,0.3); border-radius: 20px; padding: 4px 13px; letter-spacing: 0.05em; white-space: nowrap; }
.beast-card { position: relative; }
.beast-card.selected { box-shadow: 0 0 0 3px rgba(201,168,76,0.5), 0 8px 28px rgba(0,0,0,0.5) !important; transform: translateY(-4px); }
.select-indicator { position: absolute; top: 7px; right: 7px; width: 20px; height: 20px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.8); background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; z-index: 10; transition: all 0.12s ease; font-size: 0.65rem; color: #fff; font-weight: 700; line-height: 1; pointer-events: none; }
.beast-card.selected .select-indicator { background: var(--gold); border-color: #fff; }
#print-preview-overlay.active { display: flex; }
.print-preview-page { display: grid; grid-template-columns: repeat(4,1fr); gap: 6px; background: #e8e4dc; padding: 10px; border-radius: 6px; }
.print-preview-page .beast-card { font-size: 0.46rem !important; cursor: default !important; }
.print-preview-page .beast-card:hover { transform: none !important; }
.print-preview-page .card-name { font-size: 0.5rem !important; }
.print-preview-page .card-header { padding: 4px 6px !important; }
.print-preview-page .cs-label { font-size: 0.38rem !important; }
.print-preview-page .cs-val { font-size: 0.5rem !important; }
.print-preview-page .tag { font-size: 0.36rem !important; }
.print-preview-page .card-note { font-size: 0.4rem !important; padding: 3px 6px 5px !important; }
.print-preview-page .select-indicator { display: none !important; }
@media print {
  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
  body > *:not(#print-output) { display: none !important; }
  #print-output { display: block !important; }
  @page { size: A4 landscape; margin: 0; }
  .print-page { page-break-after: always; display: grid !important; grid-template-columns: repeat(4, 1fr) !important; grid-template-rows: repeat(2, 1fr) !important; gap: 3mm !important; padding: 8mm !important; width: 297mm !important; height: 210mm !important; overflow: hidden !important; background: #fff !important; }
  .print-page:last-child { page-break-after: avoid; }
  .print-page .beast-card { border-radius: 4px !important; font-size: 0.5rem !important; }
  .print-page .card-header { padding: 5px 7px !important; }
  .print-page .card-name { font-size: 0.58rem !important; }
  .print-page .cs-label { font-size: 0.42rem !important; }
  .print-page .cs-val { font-size: 0.58rem !important; }
  .print-page .tag { font-size: 0.38rem !important; }
  .print-page .select-indicator { display: none !important; }
}

#btn-filter-toggle { display: none; }
@media (max-width: 768px) {
  #card-grid { grid-template-columns: 1fr 1fr; gap: 12px; padding: 14px; }
  .header-top { padding: 8px 14px; }
  .app-title { font-size: clamp(0.7rem, 3.2vw, 1rem); }
  .app-title span { display: none; }
  .btn-print, .btn-ghost, .selection-badge, .select-indicator { display: none !important; }
  #btn-filter-toggle { display: flex; align-items: center; gap: 4px; font-size: 0.7rem; padding: 4px 10px; background: rgba(201,168,76,0.15); border: 1px solid rgba(201,168,76,0.4); color: var(--gold); border-radius: 6px; cursor: pointer; font-family: 'Cinzel', serif; font-weight: 600; letter-spacing: 0.05em; }
  .filter-bar { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0 14px; }
  .filter-bar.expanded { max-height: 600px; padding: 10px 14px 12px; }
  .druid-info-bar, .familiar-info-bar { display: none; }
  .mode-btn { font-size: 0.6rem; padding: 5px 9px; letter-spacing: 0.04em; }
  .header-top { flex-wrap: wrap; gap: 6px; padding: 8px 12px; }
  .header-top > div { gap: 6px; }
  .app-title { font-size: clamp(0.75rem, 4vw, 1rem); white-space: nowrap; }
  #app-header { overflow: hidden; }
}
@media (max-width: 420px) {
  .mode-btn { font-size: 0.55rem; padding: 4px 7px; letter-spacing: 0; }
  .app-title { font-size: 0.75rem; }
}
@media (max-width: 480px) { #card-grid { grid-template-columns: 1fr; } }
#print-output { display: none; }

/* ============================================================
   SHARED HAMBURGER NAV
   ============================================================ */
.nav-overlay {
  position:fixed;inset:0;background:rgba(0,0,0,0.55);z-index:998;
  opacity:0;pointer-events:none;transition:opacity 0.25s ease;
}
.nav-overlay.open{opacity:1;pointer-events:all;}
.nav-drawer {
  position:fixed;top:0;right:-310px;width:290px;height:100vh;
  background:rgba(13,20,45,0.99);border-left:1px solid var(--border);
  backdrop-filter:blur(16px);z-index:999;
  transition:right 0.28s cubic-bezier(0.4,0,0.2,1);
  display:flex;flex-direction:column;
}
.nav-drawer.open{right:0;}
.nav-drawer-header {
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 20px;border-bottom:1px solid var(--border);flex-shrink:0;
}
.nav-drawer-title {
  font-family:'Cinzel',serif;font-size:0.75rem;font-weight:700;
  letter-spacing:0.18em;text-transform:uppercase;color:var(--gold);
}
.nav-close-btn {
  background:none;border:none;color:var(--text-muted);font-size:1.3rem;
  cursor:pointer;padding:4px 6px;line-height:1;border-radius:4px;transition:color 0.15s;
}
.nav-close-btn:hover{color:var(--text-light);}
.nav-scroll{flex:1;overflow-y:auto;padding:8px 0 24px;}
.nav-section-label {
  font-family:'Cinzel',serif;font-size:0.58rem;font-weight:700;
  letter-spacing:0.22em;text-transform:uppercase;color:var(--text-dim);
  padding:16px 20px 6px;display:block;
}
.nav-item {
  display:flex;align-items:center;gap:12px;padding:11px 20px;
  text-decoration:none;color:var(--text-muted);
  font-family:'Cinzel',serif;font-size:0.75rem;font-weight:600;
  letter-spacing:0.07em;text-transform:uppercase;
  border-left:3px solid transparent;transition:all 0.14s;
}
.nav-item:hover,.nav-item.active{
  color:var(--gold);background:rgba(201,168,76,0.07);border-left-color:var(--gold-dim);
}
.nav-item .ni{width:1.1rem;height:1.1rem;flex-shrink:0;opacity:0.75;}
.nav-item:hover .ni,.nav-item.active .ni{opacity:1;}
.hamburger-btn {
  background:none;border:1px solid var(--border);border-radius:6px;
  padding:7px 10px;cursor:pointer;display:flex;flex-direction:column;
  gap:5px;transition:border-color 0.15s;flex-shrink:0;
}
.hamburger-btn:hover{border-color:var(--gold-dim);}
.hamburger-btn span{
  display:block;width:20px;height:2px;background:var(--text-muted);
  border-radius:2px;transition:background 0.15s;
}
.hamburger-btn:hover span{background:var(--gold);}
</style>
</head>
<body>

<!-- SHARED NAV DRAWER -->
<div class="nav-overlay" id="nav-overlay" onclick="closeNav()"></div>
<nav class="nav-drawer" id="nav-drawer">
  <div class="nav-drawer-header">
    <span class="nav-drawer-title">The Tome</span>
    <button class="nav-close-btn" onclick="closeNav()">&#x2715;</button>
  </div>
  <div class="nav-scroll">
    <span class="nav-section-label">Home</span>
    <a href="index.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      &nbsp;Hub
    </a>
    <span class="nav-section-label">Reference</span>
    <a href="spelltome.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      &nbsp;Spell Tome
    </a>
    <a href="conditions.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      &nbsp;Condition Codex
    </a>
    <a href="wildshape.html" class="nav-item active">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>
      &nbsp;Wildshape &amp; Familiar
    </a>
    <a href="monsters.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="M12.5 17h-1a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1z"/><path d="M12 2C6.5 2 2 6.5 2 12c0 3.04 1.36 5.75 3.5 7.59V20h13v-.41C20.64 17.75 22 15.04 22 12 22 6.5 17.5 2 12 2z"/></svg>
      &nbsp;Monster Codex
    </a>
    <a href="magic-items.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="6 3 18 3 22 9 12 22 2 9"/><line x1="2" y1="9" x2="22" y2="9"/><line x1="12" y1="3" x2="6" y2="9"/><line x1="12" y1="3" x2="18" y2="9"/></svg>
      &nbsp;Magic Item Compendium
    </a>
    <span class="nav-section-label">Table Tools</span>
    <a href="combat-tracker.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="21" y2="19"/><polyline points="14.5 6.5 18 3 21 3 21 6 17.5 9.5"/><line x1="5" y1="14" x2="9" y2="18"/><line x1="7" y1="17" x2="3" y2="21"/><line x1="3" y1="19" x2="5" y2="21"/></svg>
      &nbsp;Combat Tracker
    </a>
    <a href="dice-roller.html" class="nav-item">
      <svg class="ni" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="3" width="8" height="8" rx="1.5"/><rect x="13" y="3" width="8" height="8" rx="1.5"/><rect x="3" y="13" width="8" height="8" rx="1.5"/><rect x="13" y="13" width="8" height="8" rx="1.5"/><circle cx="7" cy="7" r="1" fill="currentColor" stroke="none"/><circle cx="17" cy="7" r="1" fill="currentColor" stroke="none"/><circle cx="7" cy="17" r="1" fill="currentColor" stroke="none"/><circle cx="17" cy="17" r="1" fill="currentColor" stroke="none"/></svg>
      &nbsp;Dice Roller
    </a>
  </div>
</nav>

<div id="app-header">
  <div class="header-top">
    <div class="app-title">Wildshape & Familiar <span>D&D 5e Reference</span></div>
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="mode-toggle">
        <button class="mode-btn druid active" id="btn-druid" onclick="setMode('druid')">Wildshape</button>
        <button class="mode-btn familiar" id="btn-familiar" onclick="setMode('familiar')">Familiars</button>
      </div>
      <span class="selection-badge" id="selection-count">0 selected</span>
      <button class="btn-ghost" id="btn-select-all" onclick="selectAllVisible()" disabled>Select All</button>
      <button class="btn-ghost" id="btn-clear" onclick="clearSelection()" disabled>Clear</button>
      <button class="btn btn-print" id="btn-print" onclick="openPrintPreview()" disabled>&#128424; Print to PDF</button>
      <button id="btn-filter-toggle" onclick="toggleFilters()">Filters <span id="toggle-arrow">▼</span></button>
      <button class="hamburger-btn" onclick="openNav()" aria-label="Open navigation"><span></span><span></span><span></span></button>
    </div>
  </div>
  <div class="filter-bar" id="filter-bar">
    <label for="search-input" class="filter-label">Search</label>
    <input type="text" class="search-input" id="search-input" placeholder="Search beasts…" oninput="applyFilters()" aria-label="Search beasts and familiars">
    <div id="druid-filters">
      <label for="druid-level" class="filter-label" style="margin-left:8px;">Druid Level</label>
      <select id="druid-level" onchange="applyFilters()">
        <option value="2">2</option><option value="3">3</option><option value="4">4</option>
        <option value="5">5</option><option value="6">6</option><option value="7">7</option>
        <option value="8" selected>8</option><option value="9">9</option><option value="10">10</option>
        <option value="11">11</option><option value="12">12</option><option value="13">13</option>
        <option value="14">14</option><option value="15">15</option><option value="16">16</option>
        <option value="17">17</option><option value="18">18</option><option value="20">20</option>
      </select>
      <label for="cr-filter" class="filter-label" style="margin-left:8px;">Max CR</label>
      <select id="cr-filter" onchange="applyFilters()">
        <option value="all">All eligible</option>
        <option value="0.125">1/8</option><option value="0.25">1/4</option>
        <option value="0.5">1/2</option><option value="1">1</option>
        <option value="2">2</option><option value="3">3</option>
        <option value="4">4</option><option value="6">6</option>
      </select>
    </div>
    <div class="filter-divider"></div>
    <span class="filter-label">Terrain</span>
    <div class="pill-filters" id="terrain-pills">
      <button type="button" class="pill active" data-val="all" onclick="togglePill(this,'terrain')" aria-pressed="true">All</button>
      <button type="button" class="pill" data-val="any" onclick="togglePill(this,'terrain')">Any</button>
      <button type="button" class="pill" data-val="aquatic" onclick="togglePill(this,'terrain')">Aquatic</button>
      <button type="button" class="pill" data-val="arctic" onclick="togglePill(this,'terrain')">Arctic</button>
      <button type="button" class="pill" data-val="coast" onclick="togglePill(this,'terrain')">Coast</button>
      <button type="button" class="pill" data-val="desert" onclick="togglePill(this,'terrain')">Desert</button>
      <button type="button" class="pill" data-val="forest" onclick="togglePill(this,'terrain')">Forest</button>
      <button type="button" class="pill" data-val="grassland" onclick="togglePill(this,'terrain')">Grassland</button>
      <button type="button" class="pill" data-val="hill" onclick="togglePill(this,'terrain')">Hill</button>
      <button type="button" class="pill" data-val="mountain" onclick="togglePill(this,'terrain')">Mountain</button>
      <button type="button" class="pill" data-val="swamp" onclick="togglePill(this,'terrain')">Swamp</button>
      <button type="button" class="pill" data-val="underdark" onclick="togglePill(this,'terrain')">Underdark</button>
      <button type="button" class="pill" data-val="underwater" onclick="togglePill(this,'terrain')">Underwater</button>
    </div>
    <div class="filter-divider"></div>
    <span class="filter-label">Movement</span>
    <div class="pill-filters" id="move-pills">
      <button type="button" class="pill active" data-val="all" onclick="togglePill(this,'move')" aria-pressed="true">All</button>
      <button type="button" class="pill" data-val="fly" onclick="togglePill(this,'move')">Fly</button>
      <button type="button" class="pill" data-val="swim" onclick="togglePill(this,'move')">Swim</button>
      <button type="button" class="pill" data-val="climb" onclick="togglePill(this,'move')">Climb</button>
      <button type="button" class="pill" data-val="burrow" onclick="togglePill(this,'move')">Burrow</button>
    </div>
    <button class="btn-reset" onclick="resetFilters()" style="margin-left:8px;">Reset</button>
  </div>
  <div id="info-bar-druid" class="druid-info-bar">
    <div class="druid-rule"><strong>Retain:</strong> HP becomes beast HP; Int/Wis/Cha stay yours</div>
    <div class="druid-rule"><strong>Limit:</strong> Cannot cast spells; no flying form until level 8</div>
    <div class="druid-rule"><strong>Duration:</strong> Up to half druid level in hours; can revert as bonus action</div>
    <div class="druid-rule"><strong>Uses:</strong> 2/short rest (recharge). CR max = level ÷ 3, round down</div>
  </div>
  <div id="info-bar-familiar" class="familiar-info-bar" style="display:none;">
    <div class="familiar-rule"><strong>Source:</strong> Find Familiar spell (1st level ritual, any class with access)</div>
    <div class="familiar-rule"><strong>Actions:</strong> Familiar uses its own initiative; can't attack but can use Help</div>
    <div class="familiar-rule"><strong>Bond:</strong> Telepathic link within 100 ft; share senses action</div>
    <div class="familiar-rule"><strong>Death:</strong> If reduced to 0 HP it disappears; re-summon with 1 hour ritual</div>
  </div>
</div>
<div id="results-bar"></div>
<div id="card-grid"></div>
<div id="empty-state" style="display:none;">
  <svg class="rune" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><circle cx="32" cy="32" r="28"/><path d="M32 14v36M14 32h36M20 20l24 24M44 20L20 44"/></svg>
  <h2>No Forms Found</h2>
  <p>Adjust your druid level or filters.</p>
</div>
<div id="modal-overlay" onclick="handleOverlayClick(event)">
  <div id="modal-box"></div>
</div>
<!-- PRINT PREVIEW OVERLAY -->
<div id="print-preview-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:600;flex-direction:column;align-items:center;backdrop-filter:blur(4px);">
  <div style="width:100%;max-width:700px;display:flex;align-items:center;justify-content:space-between;padding:16px 24px;flex-shrink:0;border-bottom:1px solid var(--border);">
    <div>
      <div style="font-family:'Cinzel',serif;font-size:1rem;font-weight:700;color:var(--gold);letter-spacing:0.08em;text-transform:uppercase;">Print Preview</div>
      <div style="font-size:0.8rem;color:var(--text-muted);margin-top:2px;" id="preview-page-count"></div>
    </div>
    <div style="display:flex;gap:8px;">
      <button class="btn-ghost" onclick="closePrintPreview()">Cancel</button>
      <button class="btn btn-print" onclick="executePrint()">&#128424; Open Print Dialog</button>
    </div>
  </div>
  <div id="print-pages-container" style="flex:1;overflow-y:auto;padding:24px;width:100%;max-width:700px;display:flex;flex-direction:column;gap:20px;"></div>
</div>
<div id="print-output"></div>

<script>
function cr(n) { if(n===0.125)return'1/8'; if(n===0.25)return'1/4'; if(n===0.5)return'1/2'; return String(n); }
function mod(n) { const m=Math.floor((n-10)/2); return (m>=0?'+':'')+m; }


// Wildshape beasts — SRD 5.1 beasts eligible for Wild Shape, organised by CR
const BEASTS = [
  // ── CR 0 ──────────────────────────────────────────────────────────────────
  {name:'Baboon',cr:0,size:'Small',terrain:['forest','grassland','hill'],
    ac:12,hp:3,speed:'30 ft, climb 30 ft',str:8,dex:14,con:11,int:4,wis:12,cha:6,
    passive:11,climb:true,
    abilities:[{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent to target.'}],
    actions:[{n:'Bite',t:'+1 to hit, 1d4-1 piercing.'}],
    note:'Pack Tactics on a CR 0 creature is surprisingly useful in swarms. Climb 30 ft for arboreal scouting.'},
  {name:'Cat',cr:0,size:'Tiny',terrain:['any'],
    ac:12,hp:2,speed:'40 ft, climb 30 ft',str:3,dex:15,con:10,int:3,wis:12,cha:7,
    darkvision:30,passive:13,climb:true,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'}],
    actions:[{n:'Claws',t:'+0 to hit, 1 slashing.'}],
    note:'Tiny size, climb 30 ft, darkvision 30 ft. Excellent for urban infiltration and scouting.'},
  {name:'Crab',cr:0,size:'Tiny',terrain:['coast','aquatic','underwater'],swim:true,
    ac:11,hp:2,speed:'20 ft, swim 20 ft',str:2,dex:11,con:10,int:1,wis:8,cha:2,
    blindsight:30,passive:9,
    abilities:[{n:'Amphibious',t:'Can breathe air and water.'}],
    actions:[{n:'Claw',t:'+0 to hit, 1 bludgeoning.'}],
    note:'Blindsight 30 ft. Amphibious. Tiny size for coastal infiltration.'},
  {name:'Deer',cr:0,size:'Medium',terrain:['forest','grassland'],
    ac:13,hp:4,speed:'50 ft',str:11,dex:16,con:11,int:2,wis:14,cha:5,
    passive:12,
    abilities:[],
    actions:[{n:'Bite',t:'+2 to hit, 1d4 piercing.'}],
    note:'50 ft speed is highest of any CR 0 form. Passive Perception 12. Useful for rapid scouting or escape.'},
  {name:'Eagle',cr:0,size:'Small',terrain:['grassland','mountain','coast'],fly:true,
    ac:12,hp:3,speed:'10 ft, fly 60 ft',str:6,dex:15,con:10,int:2,wis:14,cha:7,
    passive:14,
    abilities:[{n:'Keen Sight',t:'Advantage on Perception checks relying on sight.'}],
    actions:[{n:'Talons',t:'+4 to hit, 1d4+2 slashing.'}],
    note:'Passive Perception 14 — tied for highest of any CR 0 beast. Fly 60 ft. Requires level 8+.'},
  {name:'Frog',cr:0,size:'Tiny',terrain:['swamp','coast','aquatic'],swim:true,
    ac:11,hp:1,speed:'20 ft, swim 20 ft',str:1,dex:13,con:8,int:1,wis:8,cha:3,
    passive:10,
    abilities:[{n:'Amphibious',t:'Can breathe air and water.'},{n:'Standing Leap',t:'Long jump up to 10 ft, high jump up to 5 ft with or without a running start.'}],
    actions:[{n:'Bite',t:'+1 to hit, 1 piercing.'}],
    note:'Amphibious. Tiny size ideal for infiltration. Standing Leap useful for navigating terrain.'},
  {name:'Giant Fire Beetle',cr:0,size:'Small',terrain:['underdark','forest'],burrow:true,
    ac:13,hp:4,speed:'30 ft',str:8,dex:10,con:12,int:1,wis:7,cha:3,
    passive:8,
    abilities:[{n:'Illumination',t:'Sheds bright light in a 10 ft radius and dim light for another 10 ft.'}],
    actions:[{n:'Bite',t:'+1 to hit, 1d6-1 fire.'}],
    note:'The Illumination trait is the reason to use this form — provides 10 ft bright light without using an action or item. Useful for Underdark exploration.'},
  {name:'Goat',cr:0,size:'Medium',terrain:['mountain','hill','grassland'],
    ac:10,hp:4,speed:'40 ft',str:12,dex:10,con:11,int:2,wis:10,cha:5,
    passive:10,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Ram, target DC 10 Str or knocked prone.'},{n:'Sure-Footed',t:'Advantage on Str and Dex saves against being knocked prone.'}],
    actions:[{n:'Ram',t:'+3 to hit, 1d4+1 bludgeoning.'}],
    note:'Charge prone at CR 0. Sure-Footed excellent for mountain terrain. Underrated utility form.'},
  {name:'Hawk',cr:0,size:'Tiny',terrain:['grassland','forest','hill','coast'],fly:true,
    ac:13,hp:1,speed:'10 ft, fly 60 ft',str:5,dex:16,con:8,int:2,wis:14,cha:6,
    passive:14,
    abilities:[{n:'Keen Sight',t:'Advantage on Perception checks relying on sight.'}],
    actions:[{n:'Talons',t:'+5 to hit, 1 slashing.'}],
    note:'Passive Perception 14 — tied for highest of any CR 0 form. Best Tiny aerial scout. Requires level 8+.'},
  {name:'Hyena',cr:0,size:'Medium',terrain:['desert','grassland'],
    ac:11,hp:5,speed:'50 ft',str:11,dex:13,con:12,int:2,wis:12,cha:5,
    passive:13,
    abilities:[{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent to target.'}],
    actions:[{n:'Bite',t:'+2 to hit, 1d6 piercing.'}],
    note:'50 ft speed and Pack Tactics at CR 0 make this a standout early scout form.'},
  {name:'Jackal',cr:0,size:'Small',terrain:['desert','grassland'],
    ac:12,hp:3,speed:'40 ft',str:8,dex:15,con:11,int:3,wis:12,cha:6,
    passive:13,
    abilities:[{n:'Keen Hearing and Smell',t:'Advantage on Perception checks.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent.'}],
    actions:[{n:'Bite',t:'+1 to hit, 1d4-1 piercing.'}],
    note:'Pack Tactics plus Keen Hearing and Smell. Small size, desert/grassland. Useful for group scouting.'},
  {name:'Lizard',cr:0,size:'Tiny',terrain:['forest','desert','swamp'],climb:true,
    ac:10,hp:2,speed:'20 ft, climb 20 ft',str:2,dex:11,con:10,int:1,wis:8,cha:3,
    darkvision:30,passive:9,
    abilities:[],
    actions:[{n:'Bite',t:'+0 to hit, 1 piercing.'}],
    note:'Darkvision 30 ft, climb 20 ft. Tiny size for ceiling/wall traversal. Very low profile for indoor infiltration.'},
  {name:'Octopus',cr:0,size:'Small',terrain:['aquatic','underwater','coast'],swim:true,
    ac:12,hp:3,speed:'5 ft, swim 30 ft',str:4,dex:15,con:11,int:3,wis:10,cha:4,
    darkvision:30,passive:12,
    abilities:[{n:'Hold Breath',t:'Out of water for up to 30 minutes.'},{n:'Underwater Camouflage',t:'Advantage on Stealth in water.'},{n:'Water Breathing',t:'Breathes only underwater.'}],
    actions:[{n:'Tentacles',t:'+4 to hit, 1 bludgeoning. Grappled (DC 10).'},{n:'Ink Cloud (Recharge 6)',t:'5 ft radius heavily obscured for 1 min.'}],
    note:'Darkvision 30 ft, Ink Cloud, underwater camouflage. Best Tiny aquatic scouting form.'},
  {name:'Owl',cr:0,size:'Tiny',terrain:['forest','grassland','hill'],fly:true,
    ac:11,hp:1,speed:'5 ft, fly 60 ft',str:3,dex:13,con:8,int:2,wis:12,cha:7,
    darkvision:120,passive:13,
    abilities:[{n:'Flyby',t:'No opportunity attacks when flying out of reach.'},{n:'Keen Hearing and Sight',t:'Advantage on Perception checks.'}],
    actions:[{n:'Talons',t:'+3 to hit, 1 slashing.'}],
    note:'Darkvision 120 ft. Flyby prevents opportunity attacks. Excellent night scout at level 8+.'},
  {name:'Quipper',cr:0,size:'Tiny',terrain:['aquatic','underwater'],swim:true,
    ac:13,hp:1,speed:'0 ft, swim 40 ft',darkvision:60,passive:13,
    str:2,dex:16,con:9,int:1,wis:7,cha:2,
    abilities:[{n:'Blood Frenzy',t:'Advantage on attack rolls against creatures that have taken damage.'}],
    actions:[{n:'Bite',t:'+5 to hit, 1 piercing.'}],
    note:'Darkvision 60 ft, swim 40 ft. Blood Frenzy advantage vs injured creatures. Tiny aquatic.'},
  {name:'Rat',cr:0,size:'Tiny',terrain:['any'],
    ac:10,hp:1,speed:'20 ft',str:2,dex:11,con:9,int:2,wis:10,cha:4,
    darkvision:30,passive:10,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'}],
    actions:[{n:'Bite',t:'+0 to hit, 1 piercing.'}],
    note:'Tiny, any terrain, darkvision 30 ft. Low-profile city infiltration form. Easily overlooked.'},
  {name:'Raven',cr:0,size:'Tiny',terrain:['forest','grassland','hill','any'],fly:true,
    ac:12,hp:1,speed:'10 ft, fly 50 ft',str:2,dex:14,con:8,int:2,wis:12,cha:6,
    passive:13,
    abilities:[{n:'Mimicry',t:'Can mimic simple sounds it has heard. DC 10 Insight to recognise as imitation.'}],
    actions:[{n:'Beak',t:'+4 to hit, 1 piercing.'}],
    note:'Mimicry trait provides unique utility for communication. Fly 50 ft. Popular familiar choice.'},
  {name:'Scorpion',cr:0,size:'Tiny',terrain:['desert','underdark'],
    ac:11,hp:1,speed:'10 ft',str:2,dex:11,con:8,int:1,wis:8,cha:2,
    blindsight:10,passive:9,
    abilities:[],
    actions:[{n:'Sting',t:'+2 to hit, 1 piercing + 1d4 poison. DC 9 Con or poisoned for 1 min.'}],
    note:'Blindsight 10 ft. Tiny for desert/underdark infiltration. Poison sting is niche but unique at CR 0.'},
  {name:'Sea Horse',cr:0,size:'Tiny',terrain:['aquatic','underwater'],swim:true,
    ac:11,hp:1,speed:'0 ft, swim 20 ft',str:1,dex:12,con:8,int:1,wis:10,cha:2,
    passive:10,
    abilities:[{n:'Water Breathing',t:'Breathes only underwater.'}],
    actions:[],
    note:'Aquatic-only. No attacks. Purely a scouting/infiltration form in fully underwater environments.'},
  {name:'Spider',cr:0,size:'Tiny',terrain:['forest','underdark','any'],climb:true,
    ac:12,hp:1,speed:'20 ft, climb 20 ft',str:2,dex:14,con:8,int:1,wis:10,cha:2,
    darkvision:30,passive:10,
    abilities:[{n:'Spider Climb',t:'Can climb difficult surfaces including ceilings without checks.'},{n:'Web Sense',t:'While in contact with a web, knows location of any creature touching the web.'},{n:'Web Walker',t:'Movement unaffected by webs.'}],
    actions:[{n:'Bite',t:'+4 to hit, 1 piercing + 1d4 poison. DC 9 Con or poisoned for 1 min.'}],
    note:'Spider Climb (ceilings, walls with no check), Web Sense, darkvision 30 ft. Best ceiling traversal form.'},
  {name:'Vulture',cr:0,size:'Medium',terrain:['desert','grassland','mountain'],fly:true,
    ac:10,hp:5,speed:'10 ft, fly 50 ft',str:7,dex:10,con:13,int:2,wis:12,cha:4,
    passive:13,
    abilities:[{n:'Keen Sight and Smell',t:'Advantage on Perception checks.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent.'}],
    actions:[{n:'Beak',t:'+2 to hit, 1d6+2 piercing.'}],
    note:'Pack Tactics plus Keen Sight and Smell. Fly 50 ft. Desert/grassland scout at level 8+.'},
  {name:'Weasel',cr:0,size:'Tiny',terrain:['forest','grassland','hill'],
    ac:13,hp:1,speed:'30 ft',str:3,dex:16,con:8,int:2,wis:12,cha:3,
    passive:13,
    abilities:[{n:'Keen Hearing and Smell',t:'Advantage on Perception checks.'}],
    actions:[{n:'Bite',t:'+5 to hit, 1 piercing.'}],
    note:'AC 13 — highest of any Tiny beast. Passive Perception 13. Excellent light stealth scouting form.'},
  // ── CR 1/8 ────────────────────────────────────────────────────────────────
  {name:'Blood Hawk',cr:0.125,size:'Small',terrain:['mountain','grassland','hill'],fly:true,
    ac:12,hp:7,speed:'10 ft, fly 60 ft',str:6,dex:14,con:10,int:3,wis:14,cha:5,
    passive:14,
    abilities:[{n:'Keen Sight',t:'Advantage on Perception checks relying on sight.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent.'}],
    actions:[{n:'Beak',t:'+4 to hit, 1d4+2 piercing.'}],
    note:'Pack Tactics plus Keen Sight. Passive Perception 14. Flying form requiring level 8+. Useful in groups.'},
  {name:'Camel',cr:0.125,size:'Large',terrain:['desert'],
    ac:9,hp:15,speed:'50 ft',str:16,dex:8,con:14,int:2,wis:8,cha:5,
    passive:9,
    abilities:[],
    actions:[{n:'Bite',t:'+5 to hit, 1d4+3 piercing.'}],
    note:'Str 16 and 15 HP at CR 1/8. Large size. Rapid desert traversal with 50 ft speed. Surprisingly beefy for its CR.'},
  {name:'Flying Snake',cr:0.125,size:'Tiny',terrain:['forest','desert','swamp','coast'],fly:true,swim:true,
    ac:14,hp:5,speed:'30 ft, fly 60 ft, swim 30 ft',str:4,dex:18,con:11,int:2,wis:12,cha:5,
    blindsight:10,passive:11,
    abilities:[{n:'Flyby',t:'No opportunity attacks when flying out of reach.'}],
    actions:[{n:'Bite',t:'+6 to hit, 1 piercing + 3d4 poison. DC 11 Con or poisoned for 1 hr.'}],
    note:'AC 14 and Dex 18 at CR 1/8 make this a surprisingly capable form. Flyby plus fly/swim. Poison bite. Requires level 8+ for flight.'},
  {name:'Giant Crab',cr:0.125,size:'Medium',terrain:['coast','aquatic','underwater'],swim:true,
    ac:15,hp:13,speed:'30 ft, swim 30 ft',str:13,dex:15,con:11,int:1,wis:9,cha:3,
    blindsight:30,passive:9,
    abilities:[{n:'Amphibious',t:'Can breathe air and water.'}],
    actions:[{n:'Claw',t:'+3 to hit, 1d6+1 bludgeoning. Grappled (DC 11).'}],
    note:'AC 15 — tied for highest AC wildshape form. Blindsight 30 ft. Grapple claw. Excellent coastal tank.'},
  {name:'Giant Rat',cr:0.125,size:'Small',terrain:['any'],
    ac:12,hp:7,speed:'30 ft',str:7,dex:15,con:11,int:2,wis:10,cha:4,
    darkvision:60,passive:10,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent.'}],
    actions:[{n:'Bite',t:'+4 to hit, 1d4+2 piercing.'}],
    note:'Darkvision 60 ft. Pack Tactics. Small size for infiltration. Better senses than the standard Rat.'},
  {name:'Giant Weasel',cr:0.125,size:'Medium',terrain:['forest','grassland','hill'],
    ac:13,hp:9,speed:'40 ft',str:11,dex:16,con:10,int:4,wis:12,cha:5,
    darkvision:60,passive:13,
    abilities:[{n:'Keen Hearing and Smell',t:'Advantage on Perception checks.'}],
    actions:[{n:'Bite',t:'+5 to hit, 1d4+3 piercing.'}],
    note:'Darkvision 60 ft, AC 13, Passive Perception 13. Medium-sized high-perception scout.'},
  {name:'Mastiff',cr:0.125,size:'Medium',terrain:['any'],
    ac:12,hp:5,speed:'40 ft',str:13,dex:14,con:12,int:3,wis:12,cha:7,
    passive:13,
    abilities:[{n:'Keen Hearing and Smell',t:'Advantage on Perception checks.'}],
    actions:[{n:'Bite',t:'+3 to hit, 1d6+1 piercing. DC 11 Str or knocked prone.'}],
    note:'Prone on bite. Passive Perception 13. Reliable early-game utility form. Medium size.'},
  {name:'Mule',cr:0.125,size:'Medium',terrain:['any'],
    ac:10,hp:11,speed:'40 ft',str:14,dex:10,con:13,int:2,wis:10,cha:5,
    passive:10,
    abilities:[{n:'Beast of Burden',t:'Counts as Large when determining carrying capacity.'},{n:'Sure-Footed',t:'Advantage on Str and Dex saves to avoid being knocked prone.'}],
    actions:[{n:'Hooves',t:'+4 to hit, 1d4+2 bludgeoning.'}],
    note:'Beast of Burden: carries as a Large creature. Sure-Footed. Solid pack animal form for overland travel roleplay.'},
  {name:'Poisonous Snake',cr:0.125,size:'Tiny',terrain:['forest','grassland','swamp'],swim:true,
    ac:13,hp:2,speed:'30 ft, swim 30 ft',str:2,dex:16,con:11,int:1,wis:10,cha:3,
    blindsight:10,passive:10,
    abilities:[],
    actions:[{n:'Bite',t:'+5 to hit, 1 piercing + 2d4 poison. DC 10 Con or poisoned for 1 minute.'}],
    note:'Blindsight 10 ft. High +5 to hit for CR 1/8. Poison delivery useful in some situations.'},
  {name:'Stirge',cr:0.125,size:'Tiny',terrain:['forest','swamp','underdark'],fly:true,
    ac:14,hp:2,speed:'10 ft, fly 40 ft',str:4,dex:16,con:11,int:2,wis:8,cha:6,
    darkvision:60,passive:9,
    abilities:[],
    actions:[{n:'Blood Drain',t:'+5 to hit, 1d4+3 piercing. Attaches to target; end of each turn deals 1d4+3 piercing.'}],
    note:'AC 14 — among the highest for CR 1/8. Darkvision 60 ft. Blood Drain attachment is tactically unique. Requires level 8+ for flight.'},
  // ── CR 1/4 ────────────────────────────────────────────────────────────────
  {name:'Axe Beak',cr:0.25,size:'Large',terrain:['grassland'],
    ac:11,hp:19,speed:'50 ft',str:14,dex:12,con:12,int:2,wis:10,cha:5,
    passive:10,
    abilities:[],
    actions:[{n:'Beak',t:'+4 to hit, 1d8+2 slashing.'}],
    note:'50 ft speed — fast for a CR 1/4 Large form. Simple but effective for terrain coverage.'},
  {name:'Boar',cr:0.25,size:'Medium',terrain:['forest','grassland','swamp'],
    ac:11,hp:11,speed:'40 ft',str:13,dex:11,con:12,int:2,wis:9,cha:5,
    passive:9,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Tusks, target DC 11 Str or knocked prone.'},{n:'Relentless (Recharge 5-6)',t:'Drops to 1 HP instead of 0 HP (once per recharge).'}],
    actions:[{n:'Tusks',t:'+3 to hit, 1d6+1 slashing.'}],
    note:'Relentless: once per recharge, survives a killing blow at 1 HP. Charge prone. Surprisingly tough early form.'},
  {name:'Constrictor Snake',cr:0.25,size:'Large',terrain:['forest','swamp','coast','aquatic'],swim:true,
    ac:12,hp:13,speed:'30 ft, swim 30 ft',str:15,dex:14,con:12,int:1,wis:10,cha:3,
    blindsight:10,passive:10,
    abilities:[],
    actions:[{n:'Bite',t:'+4 to hit, 1d6+2 piercing.'},{n:'Constrict',t:'+4 to hit, 1d8+2 bludgeoning. Target grappled (DC 14 Str); restrained while grappled.'}],
    note:'Restraining Constrict is excellent utility. Large size. Blindsight 10 ft. Swim 30 ft.'},
  {name:'Elk',cr:0.25,size:'Large',terrain:['forest','grassland','hill'],
    ac:10,hp:13,speed:'50 ft',str:16,dex:10,con:12,int:2,wis:10,cha:6,
    passive:12,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Ram, target DC 13 Str or knocked prone.'}],
    actions:[{n:'Ram',t:'+5 to hit, 1d6+3 bludgeoning.'},{n:'Hooves',t:'+5 to hit, 2d4+3 bludgeoning (prone targets only).'}],
    note:'50 ft speed; Str 16. Charge prone; Hooves bonus vs prone. Effective runner and charger.'},
  {name:'Giant Badger',cr:0.25,size:'Medium',terrain:['forest','hill','grassland'],burrow:true,
    ac:10,hp:13,speed:'30 ft, burrow 10 ft',str:13,dex:10,con:15,int:2,wis:12,cha:5,
    darkvision:30,passive:11,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'}],
    actions:[{n:'Multiattack',t:'One Bite and one Claws.'},{n:'Bite',t:'+3 to hit, 1d6+1 piercing.'},{n:'Claws',t:'+3 to hit, 2d4+1 slashing.'}],
    note:'Multiattack at CR 1/4 is unusual and valuable. Burrow 10 ft for tunnelling. Darkvision 30 ft.'},
  {name:'Giant Lizard',cr:0.25,size:'Large',terrain:['desert','forest','swamp'],climb:true,
    ac:12,hp:19,speed:'30 ft, climb 30 ft',str:15,dex:12,con:13,int:2,wis:10,cha:5,
    darkvision:30,passive:10,climb:true,
    abilities:[],
    actions:[{n:'Bite',t:'+4 to hit, 1d8+2 piercing.'},{n:'Tail',t:'+4 to hit, 1d6+2 bludgeoning.'}],
    note:'Darkvision 30 ft, climb 30 ft, Large size. Useful in desert/forest/swamp with vertical terrain.'},
  {name:'Giant Poisonous Snake',cr:0.25,size:'Medium',terrain:['forest','swamp','grassland'],swim:true,
    ac:14,hp:11,speed:'30 ft, swim 30 ft',str:10,dex:18,con:13,int:2,wis:10,cha:3,
    blindsight:10,passive:10,
    abilities:[],
    actions:[{n:'Bite',t:'+6 to hit, 1d4 piercing + 3d6 poison. DC 11 Con or poisoned for 1 hour.'}],
    note:'AC 14 and +6 to hit at CR 1/4 are impressive. 3d6 poison damage. Blindsight 10 ft. Strong early gish form.'},
  {name:'Giant Wolf Spider',cr:0.25,size:'Medium',terrain:['forest','grassland','underdark'],climb:true,
    ac:13,hp:11,speed:'40 ft, climb 40 ft',str:12,dex:16,con:13,int:3,wis:12,cha:4,
    darkvision:60,blindsight:10,passive:13,
    abilities:[{n:'Spider Climb',t:'Climb difficult surfaces including ceilings.'},{n:'Web Sense',t:'Knows location of web-touching creatures.'},{n:'Web Walker',t:'Movement unaffected by webs.'}],
    actions:[{n:'Bite',t:'+3 to hit, 1d6+1 piercing + 2d6 poison. DC 11 Con or paralyzed for 1 min.'}],
    note:'Spider Climb, darkvision 60 ft, blindsight 10 ft. Paralysis poison is potent. Strong early-game ambush form.'},
  {name:'Panther',cr:0.25,size:'Medium',terrain:['forest','grassland'],climb:true,
    ac:12,hp:13,speed:'50 ft, climb 40 ft',str:14,dex:15,con:10,int:3,wis:14,cha:7,
    passive:14,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception relying on smell.'},{n:'Pounce',t:'If moves 20+ ft toward target and hits with Claws, target DC 12 Str or knocked prone; bonus Bite attack.'}],
    actions:[{n:'Bite',t:'+4 to hit, 1d6+2 piercing.'},{n:'Claws',t:'+4 to hit, 1d4+2 slashing.'}],
    note:'Pounce combo highly effective in early combat. 50 ft speed is excellent. Best mobility of CR 1/4 forms.'},
  {name:'Pteranodon',cr:0.25,size:'Medium',terrain:['coast','mountain','grassland'],fly:true,
    ac:13,hp:13,speed:'10 ft, fly 60 ft',str:12,dex:15,con:10,int:2,wis:9,cha:5,
    passive:9,
    abilities:[{n:'Flyby',t:'No opportunity attacks when flying out of reach.'}],
    actions:[{n:'Bite',t:'+3 to hit, 2d4+1 piercing.'}],
    note:'Flyby means no opportunity attacks in flight. Fly 60 ft. Requires Druid level 8+. Useful for dive-bombing.'},
  {name:'Riding Horse',cr:0.25,size:'Large',terrain:['grassland','any'],
    ac:10,hp:13,speed:'60 ft',str:16,dex:10,con:12,int:2,wis:11,cha:7,
    passive:11,
    abilities:[],
    actions:[{n:'Hooves',t:'+5 to hit, 2d4+3 bludgeoning.'}],
    note:'60 ft speed — fastest Large form at CR 1/4. Great for overland scouting or quick battlefield repositioning.'},
  {name:'Wolf',cr:0.25,size:'Medium',terrain:['forest','grassland','hill','arctic'],
    ac:13,hp:11,speed:'40 ft',str:12,dex:15,con:12,int:3,wis:12,cha:6,
    passive:13,
    abilities:[{n:'Keen Hearing and Smell',t:'Advantage on Perception checks.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent to target.'}],
    actions:[{n:'Bite',t:'+4 to hit, 2d4+2 piercing. DC 11 Str or knocked prone.'}],
    note:'Pack Tactics + prone-on-hit. Reliable early game form. Synergises strongly with melee party members.'},
  // ── CR 1/2 ────────────────────────────────────────────────────────────────
  {name:'Ape',cr:0.5,size:'Medium',terrain:['forest'],climb:true,
    ac:12,hp:19,speed:'30 ft, climb 30 ft',str:16,dex:14,con:14,int:6,wis:12,cha:7,
    passive:13,
    abilities:[],
    actions:[{n:'Multiattack',t:'Two Fist attacks.'},{n:'Fist',t:'+5 to hit, 1d6+3 bludgeoning.'},{n:'Rock',t:'+5 to hit (20/60), 1d6+3 bludgeoning.'}],
    note:'Str 16. Multiattack plus ranged Rock throw. Climb 30 ft. Underrated combat form for CR 1/2.'},
  {name:'Black Bear',cr:0.5,size:'Medium',terrain:['forest','swamp','hill'],climb:true,
    ac:11,hp:19,speed:'40 ft, climb 30 ft',str:15,dex:10,con:14,int:2,wis:12,cha:7,
    passive:13,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'}],
    actions:[{n:'Multiattack',t:'Two attacks: one Bite and one Claws.'},{n:'Bite',t:'+4 to hit, 1d6+2 piercing.'},{n:'Claws',t:'+4 to hit, 2d4+2 slashing.'}],
    note:'First form with Multiattack accessible at level 4 (CR 1/2 = max CR at druid level 2; level 4 gives max CR 1). Excellent general-purpose combat form at levels 4–5.'},
  {name:'Crocodile',cr:0.5,size:'Large',terrain:['swamp','coast','aquatic'],swim:true,
    ac:12,hp:19,speed:'20 ft, swim 30 ft',str:15,dex:10,con:13,int:2,wis:10,cha:5,
    passive:10,
    abilities:[{n:'Hold Breath',t:'Can hold breath for 15 minutes.'}],
    actions:[{n:'Bite',t:'+4 to hit, 1d10+2 piercing. Target grappled (DC 12 Str); restrained while grappled.'}],
    note:'Aquatic grappler. Restrained-while-grappled via bite. Large size. Useful whenever water is involved.'},
  {name:'Giant Goat',cr:0.5,size:'Large',terrain:['mountain','hill'],
    ac:11,hp:19,speed:'40 ft',str:17,dex:11,con:12,int:3,wis:12,cha:6,
    passive:13,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Horns, target DC 13 Str or knocked prone.'},{n:'Sure-Footed',t:'Advantage on Str and Dex saves to avoid being knocked prone.'}],
    actions:[{n:'Ram',t:'+5 to hit, 2d4+3 bludgeoning.'}],
    note:'Str 17. Charge prone. Sure-Footed for mountain terrain. Solid mid-early wildshape.'},
  {name:'Giant Sea Horse',cr:0.5,size:'Large',terrain:['aquatic','underwater'],swim:true,
    ac:13,hp:16,speed:'0 ft, swim 40 ft',str:12,dex:15,con:11,int:2,wis:12,cha:5,
    passive:11,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Ram, target DC 11 Str or knocked prone.'},{n:'Water Breathing',t:'Breathes only underwater.'}],
    actions:[{n:'Ram',t:'+3 to hit, 2d8+1 bludgeoning.'}],
    note:'AC 13. Swim 40 ft. Charge prone in water. Large underwater form with reasonable AC.'},
  {name:'Giant Wasp',cr:0.5,size:'Medium',terrain:['forest','grassland'],fly:true,
    ac:12,hp:13,speed:'10 ft, fly 50 ft',str:10,dex:14,con:10,int:1,wis:10,cha:3,
    passive:10,
    abilities:[],
    actions:[{n:'Sting',t:'+4 to hit, 1d6+2 piercing + 2d6 poison. DC 11 Con or poisoned and incapacitated for 1 min.'}],
    note:'Fly 50 ft. Poison Sting: DC 11 Con or Poisoned AND Incapacitated — one of the best debuffs at this CR. Requires Druid level 8+.'},
  {name:'Reef Shark',cr:0.5,size:'Medium',terrain:['aquatic','underwater'],swim:true,
    ac:12,hp:22,speed:'0 ft, swim 40 ft',str:14,dex:13,con:13,int:1,wis:10,cha:4,
    blindsight:30,passive:10,
    abilities:[{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent to target.'},{n:'Water Breathing',t:'Breathes only underwater.'}],
    actions:[{n:'Bite',t:'+4 to hit, 1d8+2 piercing.'}],
    note:'Pack Tactics. Blindsight 30 ft. Solid aquatic combat form with 22 HP. Good in groups.'},
  {name:'Warhorse',cr:0.5,size:'Large',terrain:['grassland','any'],
    ac:11,hp:19,speed:'60 ft',str:18,dex:12,con:13,int:2,wis:12,cha:7,
    passive:11,
    abilities:[{n:'Trampling Charge',t:'If moves 20+ ft and hits with Hooves, target DC 14 Str or knocked prone; bonus Hooves attack.'}],
    actions:[{n:'Hooves',t:'+6 to hit, 2d6+4 bludgeoning.'}],
    note:'Str 18. 60 ft speed — fastest form at CR 1/2. Trampling Charge prone plus bonus Hooves. Excellent cavalry-style form.'},
  // ── CR 1 ──────────────────────────────────────────────────────────────────
  {name:'Brown Bear',cr:1,size:'Large',terrain:['forest','hill','arctic'],climb:true,
    ac:11,hp:34,speed:'40 ft, climb 30 ft',str:19,dex:10,con:16,int:2,wis:13,cha:7,
    passive:13,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'}],
    actions:[{n:'Multiattack',t:'Two attacks: one Bite and one Claws.'},{n:'Bite',t:'+6 to hit, 1d8+4 piercing.'},{n:'Claws',t:'+6 to hit, 2d6+4 slashing.'}],
    note:'Str 19, Multiattack. Best all-round combat wildshape for levels 6–8. First form really to threaten frontline enemies.'},
  {name:'Dire Wolf',cr:1,size:'Large',terrain:['forest','grassland','arctic','hill'],
    ac:14,hp:37,speed:'50 ft',str:17,dex:15,con:15,int:3,wis:12,cha:7,
    passive:13,
    abilities:[{n:'Keen Hearing and Smell',t:'Advantage on Perception checks.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent.'}],
    actions:[{n:'Bite',t:'+5 to hit, 2d6+3 piercing. DC 13 Str or knocked prone.'}],
    note:'AC 14 and Speed 50 ft. Pack Tactics plus prone-on-hit. Highly effective in a party — one of the best CR 1 forms.'},
  {name:'Giant Eagle',cr:1,size:'Large',terrain:['mountain','grassland','hill'],fly:true,
    ac:13,hp:26,speed:'10 ft, fly 80 ft',str:16,dex:17,con:13,int:8,wis:14,cha:10,
    passive:14,
    abilities:[{n:'Keen Sight',t:'Advantage on Perception checks relying on sight.'}],
    actions:[{n:'Multiattack',t:'Two attacks: one Beak and one Talons.'},{n:'Beak',t:'+5 to hit, 1d6+3 piercing.'},{n:'Talons',t:'+5 to hit, 2d6+3 slashing.'}],
    note:'Fly 80 ft — exceptional speed. Multiattack. Requires Druid level 8+. One of the premier flying forms.'},
  {name:'Giant Hyena',cr:1,size:'Large',terrain:['desert','grassland'],
    ac:12,hp:45,speed:'50 ft',str:16,dex:14,con:14,int:2,wis:10,cha:7,
    passive:10,
    abilities:[{n:'Rampage',t:'When reduces a creature to 0 HP with a melee attack on its turn, moves up to half its speed and makes a Bite as a bonus action.'}],
    actions:[{n:'Bite',t:'+5 to hit, 2d6+3 piercing.'}],
    note:'Most HP of any CR 1 beast (45). Rampage bonus Bite — excellent action economy when enemies are dropping.'},
  {name:'Giant Spider',cr:1,size:'Large',terrain:['forest','underdark','swamp'],climb:true,
    ac:14,hp:26,speed:'30 ft, climb 30 ft',str:14,dex:16,con:12,int:2,wis:11,cha:4,
    darkvision:60,blindsight:10,passive:10,
    abilities:[{n:'Spider Climb',t:'Climb difficult surfaces including ceilings.'},{n:'Web Sense',t:'Knows location of web-touching creatures.'},{n:'Web Walker',t:'Movement unaffected by webs.'}],
    actions:[{n:'Bite',t:'+5 to hit, 1d8+3 piercing + 2d8 poison. DC 11 Con or poisoned for 1 hr and paralyzed while poisoned.'},{n:'Web (Recharge 5-6)',t:'+5 to hit (30/60 ft), restrained until DC 12 Str check (action).'}],
    note:'AC 14, darkvision 60 ft, blindsight 10 ft, Spider Climb. Paralysis-poison and Web are exceptional utility. Strong choice at Druid level 6+.'},
  {name:'Giant Toad',cr:1,size:'Large',terrain:['swamp','grassland','coast'],swim:true,
    ac:11,hp:39,speed:'20 ft, swim 40 ft',str:15,dex:13,con:13,int:2,wis:10,cha:3,
    darkvision:30,passive:10,
    abilities:[{n:'Amphibious',t:'Can breathe air and water.'},{n:'Standing Leap',t:'Long jump up to 20 ft, high jump up to 10 ft.'}],
    actions:[{n:'Bite',t:'+4 to hit, 1d10+2 piercing + 1d10 poison. Swallowed if Huge or smaller: DC 13 Str or restrained, blinded, 3d6 acid/turn.'},{n:'Swallow',t:'Used after hitting with Bite on grappled target.'}],
    note:'39 HP. Amphibious, swim 40 ft. Swallow (restrain + blinded + acid damage) on grappled creatures is uniquely powerful.'},
  {name:'Giant Vulture',cr:1,size:'Large',terrain:['desert','grassland','mountain'],fly:true,
    ac:10,hp:22,speed:'10 ft, fly 60 ft',str:15,dex:10,con:15,int:6,wis:12,cha:7,
    passive:13,
    abilities:[{n:'Keen Sight and Smell',t:'Advantage on Perception checks.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent.'}],
    actions:[{n:'Multiattack',t:'Two attacks: one Beak and one Talons.'},{n:'Beak',t:'+4 to hit, 2d6+2 piercing.'},{n:'Talons',t:'+4 to hit, 2d6+2 slashing.'}],
    note:'Fly 60 ft, Multiattack, Pack Tactics. Passive Perception 13. Requires level 8+. Solid aerial attacker in a group.'},
  {name:'Lion',cr:1,size:'Large',terrain:['grassland','desert'],
    ac:12,hp:26,speed:'50 ft',str:17,dex:15,con:13,int:3,wis:12,cha:8,
    passive:13,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'},{n:'Pack Tactics',t:'Advantage on attacks if ally is adjacent.'},{n:'Pounce',t:'If moves 20+ ft and hits with Claws, target DC 13 Str or knocked prone; bonus Bite attack.'},{n:'Running Leap',t:'Running long jump up to 25 ft.'}],
    actions:[{n:'Bite',t:'+5 to hit, 1d8+3 piercing.'},{n:'Claws',t:'+5 to hit, 1d6+3 slashing.'}],
    note:'Pack Tactics + Pounce prone + bonus Bite. Str 17, 50 ft speed. One of the best-rounded CR 1 combat forms.'},
  {name:'Giant Octopus',cr:1,size:'Large',terrain:['aquatic','coast','underwater'],swim:true,
    ac:11,hp:52,speed:'10 ft, swim 60 ft',str:17,dex:13,con:13,int:4,wis:10,cha:4,
    darkvision:60,passive:12,
    abilities:[{n:'Hold Breath',t:'Out of water for up to 1 hour.'},{n:'Underwater Camouflage',t:'Advantage on Stealth checks in water.'},{n:'Water Breathing',t:'Breathes only underwater.'}],
    actions:[{n:'Tentacles',t:'+5 to hit, 2d6+3 bludgeoning. Grappled (DC 16) and restrained until grapple ends.'},{n:'Ink Cloud (Recharge 6)',t:'20 ft radius heavily obscured cloud for 1 minute.'}],
    note:'52 HP — highest HP of any CR 1 beast. DC 16 Restrain grapple. Ink Cloud utility. Best overall aquatic form.'},
  {name:'Tiger',cr:1,size:'Large',terrain:['forest','grassland','swamp'],swim:true,
    ac:12,hp:37,speed:'40 ft',str:17,dex:15,con:14,int:3,wis:12,cha:8,
    darkvision:60,passive:13,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'},{n:'Pounce',t:'If moves 20+ ft and hits with Claws, target DC 13 Str or knocked prone; bonus Bite attack.'}],
    actions:[{n:'Bite',t:'+5 to hit, 1d10+3 piercing.'},{n:'Claws',t:'+5 to hit, 1d8+3 slashing.'}],
    note:'Darkvision 60 ft. Pounce prone + bonus Bite. 37 HP. Str 17. Strong in forest/grassland. Can swim.'},
  // ── CR 2 ──────────────────────────────────────────────────────────────────
  {name:'Allosaurus',cr:2,size:'Large',terrain:['grassland','forest'],
    ac:13,hp:51,speed:'60 ft',str:19,dex:13,con:17,int:2,wis:12,cha:5,
    passive:11,
    abilities:[{n:'Pounce',t:'If moves 30+ ft and hits with Claws, target DC 13 Str or knocked prone; bonus Bite attack.'}],
    actions:[{n:'Bite',t:'+6 to hit, 2d8+4 piercing.'},{n:'Claw',t:'+6 to hit, 1d8+4 slashing.'}],
    note:'60 ft speed — fastest Large form. Str 19, Pounce combo. Excellent combat form for level 6+ druids.'},
  {name:'Aurochs',cr:2,size:'Large',terrain:['grassland','hill'],
    ac:11,hp:38,speed:'50 ft',str:20,dex:10,con:15,int:2,wis:12,cha:5,
    passive:11,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Gore, target DC 14 Str or knocked prone; bonus Gore attack as bonus action.'}],
    actions:[{n:'Gore',t:'+7 to hit, 2d8+5 piercing.'}],
    note:'Str 20. Double Gore potential on charge. 50 ft speed. Excellent striker form for Druid level 6+.'},
  {name:'Giant Boar',cr:2,size:'Large',terrain:['forest','grassland','swamp'],
    ac:12,hp:42,speed:'40 ft',str:17,dex:10,con:16,int:2,wis:7,cha:5,
    passive:8,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Tusks, target DC 13 Str or knocked prone.'},{n:'Relentless (Recharge 5-6)',t:'Drops to 1 HP instead of 0 HP once.'}],
    actions:[{n:'Tusks',t:'+5 to hit, 2d6+3 slashing.'}],
    note:'Relentless: survives a killing blow at 1 HP (once per recharge). Charge prone. Durable frontliner.'},
  {name:'Giant Constrictor Snake',cr:2,size:'Huge',terrain:['forest','swamp','aquatic'],swim:true,
    ac:12,hp:60,speed:'30 ft, swim 30 ft',str:19,dex:14,con:12,int:1,wis:10,cha:3,
    blindsight:10,passive:12,
    abilities:[],
    actions:[{n:'Bite',t:'+6 to hit, 2d6+4 piercing.'},{n:'Constrict',t:'+6 to hit, 2d8+4 bludgeoning. Grappled (DC 16); restrained while grappled.'}],
    note:'Huge size. 60 HP. DC 16 Constrict is very hard to escape. Blindsight 10 ft. Significant tactical footprint from Huge size.'},
  {name:'Plesiosaurus',cr:2,size:'Large',terrain:['aquatic','underwater'],swim:true,
    ac:13,hp:68,speed:'20 ft, swim 40 ft',str:18,dex:15,con:16,int:2,wis:12,cha:5,
    passive:11,
    abilities:[{n:'Hold Breath',t:'Can hold breath for 1 hour.'}],
    actions:[{n:'Bite',t:'+6 to hit, 2d8+4 piercing.'}],
    note:'68 HP — most HP of any CR 2 form. Str 18, AC 13. Holds breath for 1 hour. Excellent sustained aquatic tank.'},
  {name:'Polar Bear',cr:2,size:'Large',terrain:['arctic','coast'],swim:true,
    ac:12,hp:42,speed:'40 ft, swim 30 ft',str:20,dex:10,con:16,int:2,wis:13,cha:7,
    passive:13,
    abilities:[{n:'Keen Smell',t:'Advantage on Perception checks relying on smell.'}],
    actions:[{n:'Multiattack',t:'One Bite and one Claws.'},{n:'Bite',t:'+7 to hit, 1d8+5 piercing.'},{n:'Claws',t:'+7 to hit, 2d6+5 slashing.'}],
    note:'Str 20 — highest of any CR 2 beast. Exceptional grappler. Multiattack. Arctic and aquatic versatility.'},
  {name:'Rhinoceros',cr:2,size:'Large',terrain:['grassland'],
    ac:11,hp:45,speed:'40 ft',str:21,dex:8,con:15,int:2,wis:12,cha:6,
    passive:11,
    abilities:[{n:'Charge',t:'If moves 20+ ft and hits with Gore, target DC 15 Str or knocked prone.'}],
    actions:[{n:'Gore',t:'+7 to hit, 2d8+5 bludgeoning.'}],
    note:'Str 21 — highest Strength of any CR 2 form. DC 15 prone on Charge. 45 HP. Exceptional grappling capability.'},
  // ── CR 3 ──────────────────────────────────────────────────────────────────
  {name:'Ankylosaurus',cr:3,size:'Huge',terrain:['grassland','forest'],
    ac:15,hp:68,speed:'30 ft',str:19,dex:11,con:15,int:2,wis:12,cha:5,
    passive:11,
    abilities:[],
    actions:[{n:'Tail',t:'+7 to hit, 4d6+4 bludgeoning. DC 14 Str or knocked prone.'}],
    note:'AC 15 — highest AC of any Wildshape form. Huge size, 68 HP. Tail prone DC 14. Available from Druid level 9.'},
  {name:'Giant Scorpion',cr:3,size:'Large',terrain:['desert','underdark'],burrow:true,
    ac:15,hp:52,speed:'40 ft',str:15,dex:13,con:15,int:1,wis:9,cha:3,
    blindsight:60,passive:9,
    abilities:[],
    actions:[{n:'Multiattack',t:'Two Claws and one Sting.'},{n:'Claw',t:'+4 to hit, 1d8+2 bludgeoning. Grappled (DC 12).'},{n:'Sting',t:'+4 to hit, 1d10+2 piercing + 4d10 poison. DC 12 Con or poisoned for 1 hour.'}],
    note:'AC 15. Blindsight 60 ft. Triple-attack Multiattack. Grapple + Sting combo. Available Druid level 9.'},
  {name:'Killer Whale',cr:3,size:'Huge',terrain:['aquatic','underwater'],swim:true,
    ac:12,hp:90,speed:'0 ft, swim 60 ft',str:19,dex:10,con:13,int:3,wis:12,cha:7,
    blindsight:120,passive:13,
    abilities:[{n:'Echolocation',t:'Blindsight only works while not deafened.'},{n:'Hold Breath',t:'Can hold breath for 30 minutes.'},{n:'Keen Hearing',t:'Advantage on Perception checks relying on hearing.'}],
    actions:[{n:'Bite',t:'+6 to hit, 5d6+4 piercing.'}],
    note:'90 HP. Blindsight 120 ft. 5d6+4 damage per bite. The definitive Huge aquatic wildshape form.'},
  // ── CR 4–6 (Moon Druid higher forms) ─────────────────────────────────────
  {name:'Elephant',cr:4,size:'Huge',terrain:['grassland','desert'],
    ac:12,hp:76,speed:'40 ft',str:22,dex:9,con:17,int:3,wis:11,cha:6,
    passive:10,
    abilities:[{n:'Trampling Charge',t:'If moves 20+ ft and hits with Tusks, target DC 12 Str or knocked prone; bonus Stomp attack.'}],
    actions:[{n:'Tusks',t:'+8 to hit, 3d6+6 piercing.'},{n:'Stomp',t:'+8 to hit, 3d10+6 bludgeoning (prone targets only).'}],
    note:'Str 22. Stomp deals 3d10+6 vs prone targets. Huge size. Moon Druid level 12+ required.'},
  {name:'Giant Crocodile',cr:5,size:'Huge',terrain:['swamp','coast','aquatic'],swim:true,
    ac:14,hp:114,speed:'30 ft, swim 50 ft',str:21,dex:9,con:17,int:2,wis:10,cha:7,
    passive:10,
    abilities:[{n:'Hold Breath',t:'Can hold breath for 30 minutes.'}],
    actions:[{n:'Multiattack',t:'One Bite and one Tail.'},{n:'Bite',t:'+8 to hit, 3d10+5 piercing. Grappled (DC 16); restrained while grappled.'},{n:'Tail',t:'+8 to hit, 2d8+5 bludgeoning. DC 16 Str or knocked prone. Only vs non-grappled targets.'}],
    note:'Huge size, AC 14, 114 HP. DC 16 Restrain grapple plus Tail prone. Moon Druid level 15+. Exceptional aquatic tank and controller.'},
  {name:'Triceratops',cr:5,size:'Huge',terrain:['grassland'],
    ac:13,hp:114,speed:'50 ft',str:22,dex:9,con:17,int:2,wis:11,cha:5,
    passive:10,
    abilities:[{n:'Trampling Charge',t:'If moves 20+ ft and hits with Gore, DC 13 Str or knocked prone; bonus Stomp attack.'}],
    actions:[{n:'Gore',t:'+9 to hit, 4d8+6 piercing.'},{n:'Stomp',t:'+9 to hit, 3d10+6 bludgeoning (prone targets only).'}],
    note:'114 HP, Str 22. Trampling Charge prone + bonus Stomp. Moon Druid level 15+. Exceptional tank and damage form.'},
  {name:'Mammoth',cr:6,size:'Huge',terrain:['arctic','grassland'],
    ac:13,hp:126,speed:'40 ft',str:24,dex:9,con:21,int:3,wis:11,cha:6,
    passive:10,
    abilities:[{n:'Trampling Charge',t:'If moves 20+ ft and hits with Gore, DC 18 Str or knocked prone; bonus Stomp.'}],
    actions:[{n:'Gore',t:'+10 to hit, 4d10+7 piercing.'},{n:'Stomp',t:'+10 to hit, 4d10+7 bludgeoning (prone targets only).'}],
    note:'Str 24, 126 HP — highest HP Wildshape form. DC 18 prone on Charge. Moon Druid level 18+. The pinnacle of combat wildshape.'},
];

// Familiars — standard Find Familiar spell options (any class with access to the 1st-level ritual)
const FAMILIARS = [
  {name:'Bat',ac:12,hp:1,speed:'5 ft, fly 30 ft',blindsight:60,passive:11,
    note:'Blindsight 60 ft lets it perceive in total darkness without light. Cannot use sight, so immune to darkness and invisible creature complications in its range.',
    str:2,dex:15,con:8,int:2,wis:12,cha:4,
    traits:['Blindsight 60 ft','Echolocation','Fly 30 ft','Keen Hearing'],
    use:'Scouting in total or magical darkness. 60 ft blindsight extends your senses into areas you cannot see.'},
  {name:'Cat',ac:12,hp:2,speed:'40 ft, climb 30 ft',darkvision:30,passive:13,
    note:'40 ft movement and Climb 30 ft. Keen Smell advantage. Common and mundane in appearance — ideal for city missions.',
    str:3,dex:15,con:10,int:3,wis:12,cha:7,
    traits:['Darkvision 30 ft','Keen Smell','Climb 30 ft'],
    use:'Urban scouting and infiltration. Easily overlooked. Good Passive Perception (13).'},
  {name:'Crab',ac:11,hp:2,speed:'20 ft, swim 20 ft',blindsight:30,passive:9,
    note:'Blindsight 30 ft. Amphibious — survives on land and underwater. Niche but effective for coastal and underwater tasks.',
    str:2,dex:11,con:10,int:1,wis:8,cha:2,
    traits:['Blindsight 30 ft','Amphibious','Tiny'],
    use:'Coastal and underwater scouting. Blindsight compensates for murky or dark water.'},
  {name:'Frog',ac:11,hp:1,speed:'20 ft, swim 20 ft',passive:10,
    note:'Amphibious. Tiny size. Standing Leap: long jump 10 ft, high jump 5 ft without a running start. Mostly a scouting form for swamp and coastal settings.',
    str:1,dex:13,con:8,int:1,wis:8,cha:3,
    traits:['Amphibious','Standing Leap','Tiny'],
    use:'Aquatic and swamp infiltration. Tiny size makes it easy to hide and navigate tight spaces.'},
  {name:'Hawk',ac:13,hp:1,speed:'10 ft, fly 60 ft',passive:14,
    note:'Passive Perception 14 — highest of any standard familiar option. Fly 60 ft. Keen Sight: advantage on sight-based Perception.',
    str:5,dex:16,con:8,int:2,wis:14,cha:6,
    traits:['Fly 60 ft','Keen Sight','Passive Perception 14'],
    use:'Daytime aerial scouting. Best raw Perception of any familiar. Delivers touch spells with ease from altitude.'},
  {name:'Lizard',ac:10,hp:2,speed:'20 ft, climb 20 ft',darkvision:30,passive:9,
    note:'Darkvision 30 ft, Climb 20 ft. Tiny and easily disguised as an ordinary lizard. Very low profile for indoor and dungeon infiltration.',
    str:2,dex:11,con:10,int:1,wis:8,cha:3,
    traits:['Darkvision 30 ft','Climb 20 ft','Tiny'],
    use:'Wall and ceiling traversal. Low-profile infiltration in natural or dungeon environments.'},
  {name:'Octopus',ac:12,hp:3,speed:'5 ft, swim 30 ft',darkvision:30,passive:12,
    note:'Darkvision 30 ft. Underwater Camouflage (advantage on Stealth in water). Ink Cloud (Recharge 6) creates a 5 ft obscurement sphere. Hold Breath 30 min.',
    str:4,dex:15,con:11,int:3,wis:10,cha:4,
    traits:['Darkvision 30 ft','Underwater Camouflage','Ink Cloud (Recharge 6)','Swim 30 ft'],
    use:'Best standard aquatic familiar. Ink Cloud obscures pursuit. Camouflage for aquatic ambush reconnaissance.'},
  {name:'Owl',ac:11,hp:1,speed:'5 ft, fly 60 ft',darkvision:120,passive:13,
    note:'Darkvision 120 ft — far superior to any other familiar. Flyby: no opportunity attacks when it flies out of enemy reach. Ideal for safely delivering touch spells.',
    str:3,dex:13,con:8,int:2,wis:12,cha:7,
    traits:['Darkvision 120 ft','Flyby','Fly 60 ft','Keen Hearing & Sight'],
    use:'The gold standard familiar. Night scouting with 120 ft darkvision. Flyby enables safe touch spell delivery with zero risk.'},
  {name:'Poisonous Snake',ac:13,hp:2,speed:'30 ft, swim 30 ft',blindsight:10,passive:10,
    note:'AC 13 — highest AC of any standard familiar. Blindsight 10 ft. Swim 30 ft. Poison bite (DC 10 Con) deals 2d4 extra damage.',
    str:2,dex:16,con:11,int:1,wis:10,cha:3,
    traits:['Blindsight 10 ft','AC 13','Swim 30 ft','Poison Bite'],
    use:'Tankiest standard familiar by AC. Can deliver touch spells at melee range. Poison bite adds minor but real offensive threat.'},
  {name:'Quipper',ac:13,hp:1,speed:'0 ft, swim 40 ft',darkvision:60,passive:13,
    note:'Darkvision 60 ft. Swim 40 ft. Blood Frenzy: advantage on attacks against creatures that have taken damage this combat. Entirely aquatic.',
    str:2,dex:16,con:9,int:1,wis:7,cha:2,
    traits:['Darkvision 60 ft','Swim 40 ft','Blood Frenzy','Tiny'],
    use:'Underwater scouting with good darkvision and speed. Blood Frenzy is situationally useful in aquatic combat.'},
  {name:'Rat',ac:10,hp:1,speed:'20 ft',darkvision:30,passive:10,
    note:'Darkvision 30 ft. Keen Smell advantage. Tiny size. The most overlooked and most disguisable familiar — ignored in almost any city or dungeon.',
    str:2,dex:11,con:9,int:2,wis:10,cha:4,
    traits:['Darkvision 30 ft','Keen Smell','Tiny'],
    use:'Urban infiltration and passive observation. Rats are ignored almost everywhere — ideal for long-term placement.'},
  {name:'Raven',ac:12,hp:1,speed:'10 ft, fly 50 ft',passive:13,
    note:'Mimicry: can reproduce simple sounds or up to a few words heard recently. DC 10 Insight to identify as imitation. Fly 50 ft. Popular for message relay.',
    str:2,dex:14,con:8,int:2,wis:12,cha:6,
    traits:['Fly 50 ft','Mimicry','Tiny'],
    use:'Communication familiar. Mimicry lets it audibly relay short messages. Social encounters and messaging across the 100 ft telepathic link.'},
  {name:'Sea Horse',ac:11,hp:1,speed:'0 ft, swim 20 ft',passive:10,
    note:'Entirely aquatic. No land speed at all. Water Breathing only. Very niche — only useful in fully underwater campaigns or encounters.',
    str:1,dex:12,con:8,int:1,wis:10,cha:2,
    traits:['Swim 20 ft','Water Breathing only','Tiny'],
    use:'Aquatic-only environments. Niche utility for underwater campaigns.'},
  {name:'Spider',ac:12,hp:1,speed:'20 ft, climb 20 ft',darkvision:30,passive:10,
    note:'Spider Climb: climbs walls and ceilings with no check required. Web Sense: knows the exact location of any creature touching the same web. Web Walker: unimpeded by webs.',
    str:2,dex:14,con:8,int:1,wis:10,cha:2,
    traits:['Spider Climb','Darkvision 30 ft','Web Sense','Web Walker'],
    use:'Ceiling and wall traversal. Web Sense is uniquely useful in dungeon environments where webs are present.'},
  {name:'Weasel',ac:13,hp:1,speed:'30 ft',passive:13,
    note:'AC 13 — tied for highest AC of any standard familiar. Keen Hearing and Smell: advantage on Perception. Passive Perception 13. No darkvision.',
    str:3,dex:16,con:8,int:2,wis:12,cha:3,
    traits:['AC 13','Keen Hearing & Smell','Passive Perception 13'],
    use:'Alert and detection familiar. Best AC means it survives opportunistic swipes. Good Passive Perception for a terrestrial option.'},
];

let mode = 'druid';
let activeTerrain = new Set(['all']);
let activeMove = new Set(['all']);
let searchQ = '';

function setMode(m) {
  mode = m;
  selectedCards.clear();
  document.getElementById('btn-druid').className = 'mode-btn druid' + (m==='druid'?' active':'');
  document.getElementById('btn-familiar').className = 'mode-btn familiar' + (m==='familiar'?' active':'');
  document.getElementById('druid-filters').style.display = m==='druid' ? 'contents' : 'none';
  document.getElementById('info-bar-druid').style.display = m==='druid' ? 'flex' : 'none';
  document.getElementById('info-bar-familiar').style.display = m==='familiar' ? 'flex' : 'none';
  renderGrid();
}

function togglePill(pill, group) {
  const val = pill.dataset.val;
  const set = group === 'terrain' ? activeTerrain : activeMove;
  const id = group === 'terrain' ? 'terrain-pills' : 'move-pills';
  if (val === 'all') { set.clear(); set.add('all'); }
  else {
    set.delete('all');
    if (set.has(val)) { set.delete(val); if (set.size === 0) set.add('all'); }
    else set.add(val);
  }
  document.querySelectorAll(`#${id} .pill`).forEach(p => p.classList.toggle('active', set.has(p.dataset.val)));
  renderGrid();
}

function applyFilters() { searchQ = document.getElementById('search-input').value.toLowerCase().trim(); renderGrid(); }

function resetFilters() {
  document.getElementById('search-input').value = ''; searchQ = '';
  activeTerrain = new Set(['all']); activeMove = new Set(['all']);
  document.getElementById('druid-level').value = '8';
  document.getElementById('cr-filter').value = 'all';
  document.querySelectorAll('#terrain-pills .pill').forEach(p => p.classList.toggle('active', p.dataset.val==='all'));
  document.querySelectorAll('#move-pills .pill').forEach(p => p.classList.toggle('active', p.dataset.val==='all'));
  renderGrid();
}

function druidMaxCR() {
  const lvl = parseInt(document.getElementById('druid-level').value);
  return Math.floor(lvl / 3);
}

function filtered() {
  if (mode === 'familiar') {
    return FAMILIARS.filter(f => !searchQ || f.name.toLowerCase().includes(searchQ));
  }
  const maxCR = druidMaxCR();
  const crFilter = document.getElementById('cr-filter').value;
  const effectiveMax = crFilter === 'all' ? maxCR : Math.min(maxCR, parseFloat(crFilter));
  return BEASTS.filter(b => {
    const crOk = b.cr <= effectiveMax;
    const terrainOk = activeTerrain.has('all') || b.terrain.some(t => activeTerrain.has(t));
    const moveOk = activeMove.has('all') ||
      (activeMove.has('fly') && b.fly) ||
      (activeMove.has('swim') && b.swim) ||
      (activeMove.has('climb') && b.climb) ||
      (activeMove.has('burrow') && b.burrow);
    const searchOk = !searchQ || b.name.toLowerCase().includes(searchQ);
    // Fly restriction: need level 8
    const flyOk = !b.fly || parseInt(document.getElementById('druid-level').value) >= 8;
    const swimOk = !b.swim || parseInt(document.getElementById('druid-level').value) >= 4;
    return crOk && terrainOk && moveOk && searchOk && flyOk;
  });
}

// Derive tags consistently from any beast/familiar entry
function deriveTags(item, isFamiliar) {
  const tags = [];
  // Movement
  const flyM = item.speed && item.speed.match(/fly (\d+)/i);
  if (item.fly || flyM) tags.push(`<span class="tag fly">Fly ${flyM?flyM[1]+' ft':''}</span>`);
  const swimM = item.speed && item.speed.match(/swim (\d+)/i);
  if (item.swim || swimM) tags.push(`<span class="tag swim">Swim ${swimM?swimM[1]+' ft':''}</span>`);
  const climbM = item.speed && item.speed.match(/climb (\d+)/i);
  if (item.climb || climbM) tags.push(`<span class="tag climb">Climb ${climbM?climbM[1]+' ft':''}</span>`);
  if (item.burrow) tags.push(`<span class="tag burrow">Burrow</span>`);
  // Vision
  if (item.darkvision) tags.push(`<span class="tag darkvision">Darkvision ${item.darkvision} ft</span>`);
  if (item.blindsight) tags.push(`<span class="tag blindsight">Blindsight ${item.blindsight} ft</span>`);
  // Key traits — drawn from abilities[] for beasts, or sniffed from traits[] for familiars
  const abilityNames = [
    ...(item.abilities||[]).map(a=>a.n),
    ...(item.traits||[])
  ].join('|');
  if (/Pack Tactics/i.test(abilityNames))        tags.push(`<span class="tag pack-tactics">Pack Tactics</span>`);
  if (/Keen Smell/i.test(abilityNames))           tags.push(`<span class="tag special">Keen Smell</span>`);
  if (/Keen Sight/i.test(abilityNames))           tags.push(`<span class="tag special">Keen Sight</span>`);
  if (/Keen Hearing/i.test(abilityNames))         tags.push(`<span class="tag special">Keen Hearing</span>`);
  if (/Flyby/i.test(abilityNames))               tags.push(`<span class="tag special">Flyby</span>`);
  if (/Pounce/i.test(abilityNames))              tags.push(`<span class="tag special">Pounce</span>`);
  if (/Amphibious/i.test(abilityNames))          tags.push(`<span class="tag special">Amphibious</span>`);
  if (/Spider Climb/i.test(abilityNames))        tags.push(`<span class="tag special">Spider Climb</span>`);
  if (/Mimicry/i.test(abilityNames))             tags.push(`<span class="tag special">Mimicry</span>`);
  if (/Blood Frenzy/i.test(abilityNames))        tags.push(`<span class="tag special">Blood Frenzy</span>`);
  if (/Relentless/i.test(abilityNames))          tags.push(`<span class="tag special">Relentless</span>`);
  if (/Trampling Charge|Charge/i.test(abilityNames)) tags.push(`<span class="tag special">Charge</span>`);
  if (/Echolocation/i.test(abilityNames))        tags.push(`<span class="tag special">Echolocation</span>`);
  if (/Underwater Camouflage/i.test(abilityNames)) tags.push(`<span class="tag special">Underwater Camo</span>`);
  if (/Ink Cloud/i.test(abilityNames))           tags.push(`<span class="tag special">Ink Cloud</span>`);
  if (/Poison Bite/i.test(abilityNames))         tags.push(`<span class="tag special">Poison Bite</span>`);
  if (/Water Breathing/i.test(abilityNames))     tags.push(`<span class="tag special">Water Breathing</span>`);
  return tags;
}

function buildBeastCard(b, forPreview) {
  const color = '#2a6a3a';
  const tags = deriveTags(b, false);
  const lvlRequired = b.cr > 3 ? `<span class="tag level-req">Level ${b.cr*3}+ Druid</span>` : '';
  const indicator = forPreview ? '' : `<div class="select-indicator"></div>`;
  return `<div class="beast-card wildshape${selectedCards.has(b.name)?' selected':''}">
    ${indicator}
    <div class="card-header" style="background:${color}">
      <div class="card-name-block">
        <div class="card-name">${b.name}</div>
        <div class="card-subline">${b.size} Beast</div>
      </div>
      <span class="cr-badge">CR ${cr(b.cr)}</span>
    </div>
    <div class="card-core-stats">
      <div class="core-stat"><span class="cs-label">AC</span><span class="cs-val">${b.ac}</span></div>
      <div class="core-stat"><span class="cs-label">HP</span><span class="cs-val">${b.hp}</span></div>
      <div class="core-stat"><span class="cs-label">STR</span><span class="cs-val">${mod(b.str)}</span></div>
      <div class="core-stat"><span class="cs-label">Speed</span><span class="cs-val" style="font-size:0.65rem">${b.speed.split(',')[0]}</span></div>
    </div>
    ${tags.length || lvlRequired ? `<div class="card-tags">${lvlRequired}${tags.join('')}</div>` : ''}
    ${b.note ? `<div class="card-note">${b.note}</div>` : ''}
  </div>`;
}

function buildFamiliarCard(f, forPreview) {
  const color = '#6a2a8a';
  const tags = deriveTags(f, true);
  const indicator = forPreview ? '' : `<div class="select-indicator"></div>`;
  return `<div class="beast-card familiar${selectedCards.has(f.name)?' selected':''}">
    ${indicator}
    <div class="card-header" style="background:${color}">
      <div class="card-name-block">
        <div class="card-name">${f.name}</div>
        <div class="card-subline">Find Familiar</div>
      </div>
      <span class="cr-badge">AC ${f.ac}</span>
    </div>
    <div class="card-core-stats">
      <div class="core-stat"><span class="cs-label">AC</span><span class="cs-val">${f.ac}</span></div>
      <div class="core-stat"><span class="cs-label">HP</span><span class="cs-val">${f.hp}</span></div>
      <div class="core-stat"><span class="cs-label">Speed</span><span class="cs-val" style="font-size:0.62rem">${f.speed.split(',')[0]}</span></div>
      <div class="core-stat"><span class="cs-label">Percep.</span><span class="cs-val">${f.passive}</span></div>
    </div>
    ${tags.length ? `<div class="card-tags">${tags.join('')}</div>` : ''}
    ${f.use ? `<div class="card-note">${f.use}</div>` : ''}
  </div>`;
}

const selectedCards = new Set();

function toggleSelect(item, cardEl) {
  if (selectedCards.has(item.name)) {
    selectedCards.delete(item.name);
    cardEl.classList.remove('selected');
    cardEl.querySelector('.select-indicator').innerHTML = '';
  } else {
    selectedCards.add(item.name);
    cardEl.classList.add('selected');
    cardEl.querySelector('.select-indicator').innerHTML = '&#10003;';
  }
  updateSelectionUI();
}

function selectAllVisible() {
  filtered().forEach(item => selectedCards.add(item.name));
  document.querySelectorAll('#card-grid .beast-card').forEach(el => {
    el.classList.add('selected');
    el.querySelector('.select-indicator').innerHTML = '&#10003;';
  });
  updateSelectionUI();
}

function clearSelection() {
  selectedCards.clear();
  document.querySelectorAll('#card-grid .beast-card.selected').forEach(el => {
    el.classList.remove('selected');
    el.querySelector('.select-indicator').innerHTML = '';
  });
  updateSelectionUI();
}

function updateSelectionUI() {
  const count = selectedCards.size;
  const visibleCount = document.querySelectorAll('#card-grid .beast-card').length;
  document.getElementById('selection-count').textContent = `${count} selected`;
  document.getElementById('btn-print').disabled = count === 0;
  document.getElementById('btn-clear').disabled = count === 0;
  document.getElementById('btn-select-all').disabled = visibleCount === 0;
  const lbl = mode === 'druid' ? 'form' : 'familiar';
  document.getElementById('results-bar').textContent =
    `${visibleCount} ${lbl}${visibleCount!==1?'s':''} shown${mode==='druid'?' (max CR '+cr(druidMaxCR())+' at this level)':''}${count>0?' · '+count+' selected':''}`;
}

function renderGrid() {
  const list = filtered();
  const grid = document.getElementById('card-grid');
  const empty = document.getElementById('empty-state');
  if (!list.length) { grid.innerHTML = ''; empty.style.display = 'flex'; updateSelectionUI(); return; }
  empty.style.display = 'none';
  grid.innerHTML = (mode === 'druid' ? list.map(b => buildBeastCard(b, false)) : list.map(f => buildFamiliarCard(f, false))).join('');
  const onMobile = () => window.matchMedia('(pointer: coarse)').matches || window.innerWidth <= 768;
  grid.querySelectorAll('.beast-card').forEach((el, i) => {
    if (selectedCards.has(list[i].name)) el.querySelector('.select-indicator').innerHTML = '&#10003;';
    if (onMobile()) {
      el.addEventListener('click', () => openModal(list[i]));
    } else {
      el.addEventListener('click', () => toggleSelect(list[i], el));
      el.addEventListener('dblclick', () => openModal(list[i]));
    }
  });
  updateSelectionUI();
}

function openModal(item) {
  const box = document.getElementById('modal-box');
  const color = mode === 'druid' ? '#2a6a3a' : '#6a2a8a';
  if (mode === 'druid') {
    const b = item;
    const tags = deriveTags(b, false);
    const maxCR = druidMaxCR();
    const eligible = b.cr <= maxCR;
    const flyOk = !b.fly || parseInt(document.getElementById('druid-level').value) >= 8;
    box.innerHTML = `
      <div class="modal-header" style="background:${color}">
        <div>
          <div class="modal-title">${b.name}</div>
          <div class="modal-subtitle">${b.size} Beast — CR ${cr(b.cr)}</div>
        </div>
        <button class="modal-close" onclick="closeModal()">Close</button>
      </div>
      <div class="modal-body">
        <div class="eligibility-panel">
          <div class="eligibility-title">Wildshape Eligibility</div>
          <div class="eligibility-row">CR ${cr(b.cr)} vs max CR ${cr(maxCR)}: <span class="${eligible?'ok':'no'}">${eligible?'✓ Eligible':'✗ Not yet eligible'}</span></div>
          ${b.fly?`<div class="eligibility-row">Flying form: <span class="${flyOk?'ok':'no'}">${flyOk?'✓ Level 8 met':'✗ Requires Druid level 8'}</span></div>`:''}
          ${b.swim?`<div class="eligibility-row">Swimming form: <span class="ok">✓ No restriction</span></div>`:''}
          <div class="eligibility-row">Terrains: ${b.terrain.map(t => t.charAt(0).toUpperCase()+t.slice(1)).join(', ')}</div>
        </div>
        <div class="stat-row-grid">
          <div class="stat-box"><div class="lb">AC</div><div class="vl">${b.ac}</div></div>
          <div class="stat-box"><div class="lb">HP</div><div class="vl">${b.hp}</div></div>
          <div class="stat-box"><div class="lb">Speed</div><div class="vl" style="font-size:0.7rem">${b.speed.split(',')[0]}</div></div>
          <div class="stat-box"><div class="lb">Percep.</div><div class="vl">${b.passive}</div></div>
        </div>
        <div class="ab-grid">
          ${['STR','DEX','CON','INT','WIS','CHA'].map((ab,i)=>{const v=[b.str,b.dex,b.con,b.int,b.wis,b.cha][i];return`<div class="ab-box"><div class="abl">${ab}</div><div class="abs">${v}</div><div class="abm">${mod(v)}</div></div>`}).join('')}
        </div>
        ${tags.length?`<div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:12px;">${tags.join('')}</div>`:''}
        ${b.abilities?.length?`<div class="msec"><div class="msec-label" style="color:${color}">Traits</div>${b.abilities.map(a=>`<div class="mabil"><strong>${a.n}.</strong> ${a.t}</div>`).join('')}</div>`:''}
        ${b.actions?.length?`<div class="msec"><div class="msec-label" style="color:${color}">Actions</div>${b.actions.map(a=>`<div class="mabil"><strong>${a.n}.</strong> ${a.t}</div>`).join('')}</div>`:''}
        ${b.note?`<div style="background:#f0faf4;border-radius:5px;padding:10px 12px;margin-top:12px;font-style:italic;color:#555;font-size:0.88rem;">${b.note}</div>`:''}
      </div>`;
  } else {
    const f = item;
    const tags = deriveTags(f, true);
    box.innerHTML = `
      <div class="modal-header" style="background:${color}">
        <div>
          <div class="modal-title">${f.name}</div>
          <div class="modal-subtitle">Find Familiar — Celestial / Fey / Fiend form</div>
        </div>
        <button class="modal-close" onclick="closeModal()">Close</button>
      </div>
      <div class="modal-body">
        <div class="stat-row-grid">
          <div class="stat-box"><div class="lb">AC</div><div class="vl">${f.ac}</div></div>
          <div class="stat-box"><div class="lb">HP</div><div class="vl">${f.hp}</div></div>
          <div class="stat-box"><div class="lb">Speed</div><div class="vl" style="font-size:0.7rem">${f.speed.split(',')[0]}</div></div>
          <div class="stat-box"><div class="lb">Passive</div><div class="vl">${f.passive}</div></div>
        </div>
        <div class="ab-grid">
          ${['STR','DEX','CON','INT','WIS','CHA'].map((ab,i)=>{const v=[f.str,f.dex,f.con,f.int,f.wis,f.cha][i];return`<div class="ab-box"><div class="abl">${ab}</div><div class="abs">${v}</div><div class="abm">${mod(v)}</div></div>`}).join('')}
        </div>
        ${tags.length?`<div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:12px;">${tags.join('')}</div>`:''}
        ${f.note?`<div class="msec"><div class="msec-label" style="color:${color}">Notes</div><p style="font-size:0.9rem;color:#333;line-height:1.5">${f.note}</p></div>`:''}
        ${f.use?`<div style="background:#f8f0ff;border-radius:5px;padding:10px 12px;margin-top:12px;border:1px solid #d0b0e8;"><div style="font-family:'Cinzel',serif;font-size:0.68rem;font-weight:700;letter-spacing:0.1em;color:#6a2a8a;text-transform:uppercase;margin-bottom:5px;">Best Use</div><p style="font-size:0.9rem;color:#333;line-height:1.45">${f.use}</p></div>`:''}
      </div>`;
  }
  document.getElementById('modal-overlay').classList.add('active');
}

function handleOverlayClick(e) { if(e.target===document.getElementById('modal-overlay')) closeModal(); }
function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }
document.addEventListener('keydown', e => { if(e.key==='Escape') { closeModal(); closePrintPreview(); } });

function toggleFilters() {
  const bar = document.getElementById('filter-bar');
  bar.classList.toggle('expanded');
  document.getElementById('toggle-arrow').textContent = bar.classList.contains('expanded') ? '▲' : '▼';
}

function openPrintPreview() {
  const allData = mode === 'druid' ? BEASTS : FAMILIARS;
  const items = allData.filter(item => selectedCards.has(item.name));
  const pages = [];
  for (let i=0; i<items.length; i+=8) pages.push(items.slice(i,i+8));
  const container = document.getElementById('print-pages-container');
  container.innerHTML = '';
  pages.forEach((page, idx) => {
    const lbl = document.createElement('div');
    lbl.style.cssText = 'font-family:\'Cinzel\',serif;font-size:0.65rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--text-dim);margin-bottom:6px;';
    lbl.textContent = `Page ${idx+1} of ${pages.length}`;
    container.appendChild(lbl);
    const pageEl = document.createElement('div');
    pageEl.className = 'print-preview-page';
    pageEl.innerHTML = page.map(item => mode==='druid' ? buildBeastCard(item, true) : buildFamiliarCard(item, true)).join('');
    container.appendChild(pageEl);
  });
  document.getElementById('preview-page-count').textContent =
    `${items.length} card${items.length!==1?'s':''} · ${pages.length} page${pages.length!==1?'s':''}`;
  const overlay = document.getElementById('print-preview-overlay');
  overlay.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closePrintPreview() {
  document.getElementById('print-preview-overlay').classList.remove('active');
  document.body.style.overflow = '';
}

function executePrint() {
  const allData = mode === 'druid' ? BEASTS : FAMILIARS;
  const items = allData.filter(item => selectedCards.has(item.name));
  const pages = [];
  for (let i=0; i<items.length; i+=8) pages.push(items.slice(i,i+8));
  const output = document.getElementById('print-output');
  output.innerHTML = pages.map(page =>
    `<div class="print-page">${page.map(item => mode==='druid' ? buildBeastCard(item, true) : buildFamiliarCard(item, true)).join('')}</div>`
  ).join('');
  closePrintPreview();
  setTimeout(() => { window.print(); setTimeout(() => { output.innerHTML = ''; }, 1500); }, 100);
}

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('druid-level').addEventListener('change', renderGrid);
  renderGrid();
});
renderGrid();
</script>

<script>
function openNav() {
  document.getElementById('nav-drawer').classList.add('open');
  document.getElementById('nav-overlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeNav() {
  document.getElementById('nav-drawer').classList.remove('open');
  document.getElementById('nav-overlay').classList.remove('open');
  document.body.style.overflow = '';
}
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeNav(); });
</script>
</body>
</html>
